<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        // ë¡œë”© í‘œì‹œ
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // ì‹œíŠ¸ ë™ê¸°í™”
        function syncWithSheet() {
            if (!confirm('ì‹œíŠ¸ ë™ê¸°í™”ë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            showLoading();
            fetch('/sync_sheets', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.error) {
                    alert('âŒ ' + data.error);
                } else {
                    alert(data.message);
                    location.reload();
                }
            })
            .catch(error => {
                hideLoading();
                alert('âŒ Error: ' + error);
            });
        }

        // í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡
        function sendTelegramMessage(endpoint, messageName) {
            if (!confirm(`${messageName} ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            showLoading();
            fetch(endpoint, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                alert(data.message || data.error);
            })
            .catch(error => {
                hideLoading();
                alert('Error: ' + error);
            });
        }

    </script>

    <style>
        /* ì§€ì›í•˜ì§€ ì•ŠëŠ” ê³„ì • ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .status-not-supported {
            text-align: center;
            padding: 60px 30px;
        }

        .not-supported-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .not-supported-message {
            font-size: 1.5rem;
            font-weight: 700;
            color: #c62828;
            margin-bottom: 12px;
        }

        .not-supported-description {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
        }
    </style>
</head>
<body>
<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
</div>

<div class="bot-container">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="page-header">
        <div class="page-title">
            <h1>ğŸ’° ì…ì¶œê¸ˆ ê´€ë¦¬</h1>
        </div>
        <a href="/" class="back-link">â† ë©”ì¸ìœ¼ë¡œ</a>
    </div>

    <!-- ì…ì¶œê¸ˆ ì •ë³´ ì„¹ì…˜ -->
    <div class="card-section">
        <div class="section-title">ğŸ“Š ì…ì¶œê¸ˆ ì •ë³´</div>
        <div class="status-card">
            {% if admin == 'chan' or admin == 'choe' %}
            <div class="status-grid">
                <!-- ì…ê¸ˆ ì„¹ì…˜ -->
                <div class="status-section">
                    <div class="status-section-title">ğŸ’µ ì…ê¸ˆ (Deposit)</div>
                    <div class="status-field-group">
                        <div class="status-field">
                            <label>ì›í™” (KRW)</label>
                            <div class="status-display-value">â‚© {{ '{:,.0f}'.format(status.deposit_won) if status.deposit_won else '0' }}</div>
                        </div>
                        <div class="status-field">
                            <label>ë‹¬ëŸ¬ (USD)</label>
                            <div class="status-display-value">$ {{ '{:,.0f}'.format(status.deposit_dollar) if status.deposit_dollar else '0' }}</div>
                        </div>
                    </div>
                </div>

                <!-- ì¶œê¸ˆ ì„¹ì…˜ -->
                <div class="status-section">
                    <div class="status-section-title">ğŸ’¸ ì¶œê¸ˆ (Withdraw)</div>
                    <div class="status-field-group">
                        <div class="status-field">
                            <label>ì›í™” (KRW)</label>
                            <div class="status-display-value">â‚© {{ '{:,.0f}'.format(status.withdraw_won) if status.withdraw_won else '0' }}</div>
                        </div>
                        <div class="status-field">
                            <label>ë‹¬ëŸ¬ (USD)</label>
                            <div class="status-display-value">$ {{ '{:,.0f}'.format(status.withdraw_dollar) if status.withdraw_dollar else '0' }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="status-actions">
                <button type="button" onclick="syncWithSheet()" class="btn-success">ğŸ”„ ì‹œíŠ¸ ë™ê¸°í™”</button>
            </div>
            {% else %}
            <div class="status-not-supported">
                <div class="not-supported-icon">ğŸš«</div>
                <div class="not-supported-message">ì§€ì›í•˜ì§€ ì•ŠëŠ” ê³„ì •ì…ë‹ˆë‹¤</div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡ ì„¹ì…˜ -->
    <div class="card-section">
        <div class="section-title">ğŸ“± í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡</div>
        <div class="telegram-card">
            <div class="telegram-button-group">
                <button type="button" onclick="sendTelegramMessage('/send_trade_status', 'ê±°ë˜ ìƒíƒœ')" class="btn-telegram">
                    ğŸ“Š ê±°ë˜ ìƒíƒœ
                </button>
                <button type="button" onclick="sendTelegramMessage('/send_history_status', 'ê±°ë˜ ê¸°ë¡')" class="btn-telegram">
                    ğŸ“ˆ ê±°ë˜ ê¸°ë¡
                </button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
