<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        // ë¡œë”© í‘œì‹œ
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜
        function formatCurrency(input, currencySymbol) {
            let value = input.value.replace(/[^0-9.]/g, '');
            if ((value.match(/\./g) || []).length > 1) {
                value = value.replace(/\.+$/, '');
            }
            if (!isNaN(value) && value !== "") {
                const parts = value.split('.');
                parts[0] = parseInt(parts[0], 10).toLocaleString('en-US');
                input.value = currencySymbol + parts.join('.');
            } else {
                input.value = currencySymbol;
            }
            input.selectionStart = input.selectionEnd = input.value.length;
        }

        function parseCurrency(value) {
            return parseFloat(value.replace(/[^0-9.]/g, '')) || 0;
        }

        // ì…ì¶œê¸ˆ ì •ë³´ ì €ì¥
        function saveDepositWithdraw() {
            const depositWon = parseCurrency(document.getElementById('deposit_won').value);
            const depositDollar = parseCurrency(document.getElementById('deposit_dollar').value);
            const withdrawWon = parseCurrency(document.getElementById('withdraw_won').value);
            const withdrawDollar = parseCurrency(document.getElementById('withdraw_dollar').value);

            if (!confirm('ì…ì¶œê¸ˆ ì •ë³´ë¥¼ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            showLoading();
            fetch('/save_status', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    deposit_won: depositWon,
                    deposit_dollar: depositDollar,
                    withdraw_won: withdrawWon,
                    withdraw_dollar: withdrawDollar
                })
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                alert(data.message || data.error);
                if (!data.error) location.reload();
            })
            .catch(error => {
                hideLoading();
                alert('Error: ' + error);
            });
        }

        // í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡
        function sendTelegramMessage(endpoint, messageName) {
            if (!confirm(`${messageName} ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            showLoading();
            fetch(endpoint, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                alert(data.message || data.error);
            })
            .catch(error => {
                hideLoading();
                alert('Error: ' + error);
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function () {
            // ì´ˆê¸°ê°’ í¬ë§·íŒ…
            const depositWon = document.getElementById('deposit_won');
            const depositDollar = document.getElementById('deposit_dollar');
            const withdrawWon = document.getElementById('withdraw_won');
            const withdrawDollar = document.getElementById('withdraw_dollar');

            if (depositWon.value && !depositWon.value.includes('â‚©')) {
                formatCurrency(depositWon, 'â‚© ');
            }
            if (depositDollar.value && !depositDollar.value.includes('$')) {
                formatCurrency(depositDollar, '$ ');
            }
            if (withdrawWon.value && !withdrawWon.value.includes('â‚©')) {
                formatCurrency(withdrawWon, 'â‚© ');
            }
            if (withdrawDollar.value && !withdrawDollar.value.includes('$')) {
                formatCurrency(withdrawDollar, '$ ');
            }
        });
    </script>
</head>
<body>
<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
</div>

<div class="bot-container">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="page-header">
        <div class="page-title">
            <h1>ğŸ’° ì…ì¶œê¸ˆ ê´€ë¦¬</h1>
        </div>
        <a href="/" class="back-link">â† ë©”ì¸ìœ¼ë¡œ</a>
    </div>

    <!-- ì…ì¶œê¸ˆ ì •ë³´ ì„¹ì…˜ -->
    <div class="card-section">
        <div class="section-title">ğŸ“Š ì…ì¶œê¸ˆ ì •ë³´</div>
        <div class="status-card">
            <div class="status-grid">
                <!-- ì…ê¸ˆ ì„¹ì…˜ -->
                <div class="status-section">
                    <div class="status-section-title">ğŸ’µ ì…ê¸ˆ (Deposit)</div>
                    <div class="status-field-group">
                        <div class="status-field">
                            <label>ì›í™” (KRW)</label>
                            <input type="text" id="deposit_won" name="deposit_won"
                                   value="â‚© {{ '{:,.0f}'.format(status.deposit_won) if status.deposit_won else '0' }}"
                                   oninput="formatCurrency(this, 'â‚© ')" placeholder="â‚© 0">
                        </div>
                        <div class="status-field">
                            <label>ë‹¬ëŸ¬ (USD)</label>
                            <input type="text" id="deposit_dollar" name="deposit_dollar"
                                   value="$ {{ '{:,.0f}'.format(status.deposit_dollar) if status.deposit_dollar else '0' }}"
                                   oninput="formatCurrency(this, '$ ')" placeholder="$ 0">
                        </div>
                    </div>
                </div>

                <!-- ì¶œê¸ˆ ì„¹ì…˜ -->
                <div class="status-section">
                    <div class="status-section-title">ğŸ’¸ ì¶œê¸ˆ (Withdraw)</div>
                    <div class="status-field-group">
                        <div class="status-field">
                            <label>ì›í™” (KRW)</label>
                            <input type="text" id="withdraw_won" name="withdraw_won"
                                   value="â‚© {{ '{:,.0f}'.format(status.withdraw_won) if status.withdraw_won else '0' }}"
                                   oninput="formatCurrency(this, 'â‚© ')" placeholder="â‚© 0">
                        </div>
                        <div class="status-field">
                            <label>ë‹¬ëŸ¬ (USD)</label>
                            <input type="text" id="withdraw_dollar" name="withdraw_dollar"
                                   value="$ {{ '{:,.0f}'.format(status.withdraw_dollar) if status.withdraw_dollar else '0' }}"
                                   oninput="formatCurrency(this, '$ ')" placeholder="$ 0">
                        </div>
                    </div>
                </div>
            </div>

            <div class="status-actions">
                <button type="button" onclick="saveDepositWithdraw()" class="btn-success">ğŸ’¾ Save</button>
            </div>
        </div>
    </div>

    <!-- í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡ ì„¹ì…˜ -->
    <div class="card-section">
        <div class="section-title">ğŸ“± í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡</div>
        <div class="telegram-card">
            <div class="telegram-button-group">
                <button type="button" onclick="sendTelegramMessage('/send_trade_status', 'ê±°ë˜ ìƒíƒœ')" class="btn-telegram">
                    ğŸ“Š ê±°ë˜ ìƒíƒœ
                </button>
                <button type="button" onclick="sendTelegramMessage('/send_history_status', 'ê±°ë˜ ê¸°ë¡')" class="btn-telegram">
                    ğŸ“ˆ ê±°ë˜ ê¸°ë¡
                </button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
