<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Î°úÍ∑∏Ïù∏ Ìèº Ïä§ÌÉÄÏùº */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h2 {
            color: #333;
            margin: 0 0 10px 0;
            font-size: 1.8em;
        }

        .login-header p {
            color: #999;
            margin: 0;
            font-size: 0.95em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 0.95em;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9em;
            text-align: center;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .logout-btn {
            padding: 10px 20px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
        }

        .hidden {
            display: none;
        }

        /* ÏàòÏùµ Ï∂ïÌïò Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .profit-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            gap: 15px;
        }

        .profit-modal.hidden {
            display: none;
        }

        .profit-modal-content {
            background: transparent;
            border-radius: 24px;
            text-align: center;
            position: relative;
            width: 420px;
            max-width: 90%;
            overflow: visible;
            animation: modalBounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .profit-modal-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        @media (max-width: 480px) {
            .profit-modal-content {
                width: 85%;
                border-radius: 20px;
            }

            .profit-modal-text {
                padding: 20px;
            }

            .profit-title {
                font-size: 1.3em;
            }

            .profit-message {
                font-size: 0.9em;
            }

            .profit-amount {
                font-size: 1.8em;
            }

            .profit-amount-sub {
                font-size: 1em;
            }
        }

        @keyframes modalBounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3) rotate(-10deg);
            }
            50% {
                transform: scale(1.05) rotate(2deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        .profit-modal-close {
            font-size: 14px;
            background: white;
            border: 2px solid #ddd;
            cursor: pointer;
            color: #666;
            padding: 10px 30px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10001;
        }

        .profit-modal-close:hover {
            background: #f5f5f5;
            border-color: #999;
            color: #333;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .profit-emoji {
            font-size: 120px;
            text-align: center;
            animation: emojiAnimation 1s ease-in-out infinite;
            user-select: none;
        }

        @keyframes emojiAnimation {
            0%, 100% {
                transform: translateY(0) scale(1);
            }
            50% {
                transform: translateY(-8px) scale(1.05);
            }
        }

        .profit-modal-text {
            background: white;
            padding: 25px;
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .profit-title {
            font-size: 1.5em;
            margin: 0 0 8px 0;
            color: #333;
            font-weight: 700;
        }

        .profit-message {
            font-size: 1em;
            color: #666;
            margin: 0 0 10px 0;
            font-weight: 500;
        }

        .profit-amount {
            font-size: 2em;
            font-weight: 900;
            color: #2e7d32;
            margin: 0;
            letter-spacing: -0.5px;
        }

        .profit-amount-sub {
            font-size: 1.1em;
            font-weight: 600;
            color: #999;
            margin: 5px 0 0 0;
        }

        /* ÌñÑÎ≤ÑÍ±∞ Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .hamburger-btn {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            z-index: 1001;
        }

        .hamburger-btn span {
            width: 28px;
            height: 3px;
            background: #667eea;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger-btn:hover span {
            background: #5568d3;
        }

        .hamburger-btn.active span:nth-child(1) {
            transform: translateY(10px) rotate(45deg);
        }

        .hamburger-btn.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger-btn.active span:nth-child(3) {
            transform: translateY(-10px) rotate(-45deg);
        }

        /* ÏÇ¨Ïù¥Îìú Î©îÎâ¥ Ïä§ÌÉÄÏùº */
        .side-menu {
            position: fixed;
            top: 0;
            left: -320px;
            width: 280px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            transition: left 0.3s ease;
            z-index: 1002;
            overflow-y: auto;
        }

        .side-menu.active {
            left: 0;
        }

        .side-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .side-menu-header h2 {
            margin: 0;
            font-size: 1.3em;
        }

        .close-menu-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 2em;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            line-height: 1;
            transition: transform 0.2s ease;
        }

        .close-menu-btn:hover {
            transform: rotate(90deg);
        }

        .side-menu-nav {
            padding: 10px 0;
        }

        .side-menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px 20px;
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
        }

        .side-menu-item:hover {
            background: #f8f9ff;
            border-left-color: #667eea;
        }

        .side-menu-item:nth-child(2):hover {
            border-left-color: #17a2b8;
        }

        .side-menu-item:nth-child(3):hover {
            border-left-color: #28a745;
        }

        .side-menu-item:nth-child(4):hover {
            border-left-color: #ffc107;
        }

        .side-menu-icon {
            font-size: 1.8em;
            min-width: 40px;
            text-align: center;
        }

        .side-menu-text {
            flex: 1;
        }

        .side-menu-title {
            font-weight: 600;
            color: #333;
            font-size: 1em;
            margin-bottom: 2px;
        }

        .side-menu-desc {
            font-size: 0.8em;
            color: #666;
        }

        /* Ïò§Î≤ÑÎ†àÏù¥ Î∞∞Í≤Ω */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Ïò§ÎäòÏùò Í±∞Îûò ÏïÑÏΩîÎîîÏñ∏ Ïä§ÌÉÄÏùº */
        .today-trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 18px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .today-trade-header:hover {
            background: #f8f9ff;
            border-color: #667eea;
        }

        .today-trade-header.active {
            border-color: #667eea;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            margin-bottom: 0;
        }

        .today-trade-left {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .today-trade-toggle {
            font-size: 0.8rem;
            color: #667eea;
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .today-trade-header.active .today-trade-toggle {
            transform: rotate(90deg);
        }

        .today-trade-badge {
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .today-trade-badge.buy {
            background: #e3f2fd;
            color: #1565c0;
        }

        .today-trade-badge.sell {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .today-trade-name {
            font-weight: 600;
            color: #333;
            font-size: 1rem;
            line-height: 1.5;
        }

        .today-trade-symbol {
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 600;
            background: #667eea;
            color: #fff;
        }

        .today-trade-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .today-trade-amount {
            font-size: 0.85rem;
            color: #666;
        }

        .today-trade-time {
            font-size: 0.85rem;
            color: #667eea;
            font-weight: 600;
        }

        .today-trade-content {
            display: none;
            background: #fff;
            border: 1px solid #667eea;
            border-top: none;
            border-radius: 0 0 10px 10px;
            padding: 15px;
            margin-bottom: 8px;
        }

        .today-trade-content.active {
            display: block;
        }

        .today-trade-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .today-trade-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .today-trade-item.full-width {
            grid-column: 1 / -1;
        }

        .today-trade-label {
            font-size: 0.7rem;
            color: #888;
            margin-bottom: 4px;
        }

        .today-trade-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
        }

        @media (max-width: 768px) {
            .today-trade-header {
                padding: 16px 14px;
            }

            .today-trade-left {
                gap: 8px;
            }

            .today-trade-right {
                gap: 10px;
            }

            .today-trade-name {
                font-size: 0.9rem;
            }

            .today-trade-badge {
                font-size: 0.65rem;
                padding: 2px 6px;
            }

            .today-trade-symbol {
                font-size: 0.65rem;
                padding: 2px 6px;
            }

            .today-trade-amount {
                font-size: 0.8rem;
            }

            .today-trade-time {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .today-trade-header {
                padding: 14px 12px;
            }

            .today-trade-left {
                gap: 6px;
            }

            .today-trade-right {
                gap: 8px;
            }

            .today-trade-name {
                font-size: 0.85rem;
            }

            .today-trade-badge {
                font-size: 0.6rem;
                padding: 2px 5px;
            }

            .today-trade-symbol {
                font-size: 0.6rem;
                padding: 2px 5px;
            }

            .today-trade-amount {
                font-size: 0.75rem;
            }

            .today-trade-time {
                font-size: 0.75rem;
            }
        }

        .profit-positive {
            color: #c62828 !important;
        }

        .profit-negative {
            color: #1565c0 !important;
        }

        /* ÏñºÎüø Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .alert-section {
            margin-bottom: 16px;
        }

        .alert-card {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 16px;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .alert-card:last-child {
            margin-bottom: 0;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border: 1px solid #ffb74d;
        }

        .alert-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 1px solid #64b5f6;
        }

        .alert-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }

        .alert-warning .alert-title {
            color: #e65100;
        }

        .alert-info .alert-title {
            color: #1565c0;
        }

        .alert-message {
            font-size: 0.85rem;
            color: #555;
            margin-bottom: 4px;
        }

        .alert-detail {
            font-size: 0.75rem;
            color: #888;
        }

        @media (max-width: 480px) {
            .alert-card {
                padding: 12px 14px;
                gap: 10px;
            }

            .alert-icon {
                font-size: 1.3rem;
            }

            .alert-title {
                font-size: 0.9rem;
            }

            .alert-message {
                font-size: 0.8rem;
            }

            .alert-detail {
                font-size: 0.7rem;
            }
        }

        /* ÎÇ†Ïßú ÏÑ†ÌÉù Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .date-select-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: #fff;
            font-size: 0.8rem;
            color: #667eea;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .date-select-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .date-select-icon {
            font-size: 0.9rem;
        }

        /* ÎÇ†Ïßú ÏÑ†ÌÉù Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .date-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .date-modal-overlay.active {
            display: flex;
        }

        .date-modal-card {
            background: #fff;
            border-radius: 15px;
            padding: 20px;
            width: 88%;
            max-width: 340px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .date-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }

        .date-modal-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #333;
        }

        .date-modal-close {
            background: none;
            border: none;
            color: #999;
            font-size: 1.6rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .date-modal-close:hover {
            color: #333;
        }

        .date-modal-body {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .date-picker-presets {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
        }

        .date-preset-btn {
            padding: 8px 6px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fff;
            font-size: 0.8rem;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            white-space: nowrap;
        }

        .date-preset-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .date-preset-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: #fff;
        }

        .date-picker-row {
            display: flex;
            gap: 10px;
        }

        .date-picker-field {
            flex: 1;
            min-width: 0;
        }

        .date-picker-field label {
            display: block;
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 4px;
        }

        .date-picker-field input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.85rem;
            background: #fff;
            box-sizing: border-box;
        }

        .date-picker-field input:focus {
            outline: none;
            border-color: #667eea;
        }

        .date-modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }

        .date-modal-btn-cancel,
        .date-modal-btn-submit {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .date-modal-btn-cancel {
            background: #f0f0f0;
            color: #666;
        }

        .date-modal-btn-cancel:hover {
            background: #e0e0e0;
        }

        .date-modal-btn-submit {
            background: #667eea;
            color: #fff;
        }

        .date-modal-btn-submit:hover {
            background: #5568d3;
        }

        .trades-loading {
            text-align: center;
            padding: 30px;
            color: #888;
            font-size: 0.9rem;
        }

        .no-trades-message {
            text-align: center;
            padding: 30px;
            color: #888;
            font-size: 0.9rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        @media (max-width: 480px) {
            .date-select-btn {
                padding: 5px 10px;
                font-size: 0.75rem;
            }

            .date-modal-card {
                padding: 16px;
                width: 92%;
            }

            .date-modal-header {
                margin-bottom: 14px;
                padding-bottom: 10px;
            }

            .date-modal-title {
                font-size: 1rem;
            }

            .date-modal-body {
                gap: 12px;
            }

            .date-picker-presets {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
            }

            .date-preset-btn {
                padding: 7px 4px;
                font-size: 0.75rem;
            }

            .date-picker-row {
                flex-direction: column;
                gap: 12px;
            }

            .date-picker-field input {
                padding: 8px 6px;
                font-size: 0.8rem;
            }

            .date-modal-actions {
                gap: 8px;
                margin-top: 4px;
            }

            .date-modal-btn-cancel,
            .date-modal-btn-submit {
                padding: 10px;
                font-size: 0.9rem;
            }
        }

        /* Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏïÑÏΩîÎîîÏñ∏ Ïä§ÌÉÄÏùº - ÏãúÏû•ÏßÄÌëúÏôÄ ÎèôÏùº */
        .portfolio-accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 18px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .portfolio-accordion-header:hover {
            background: #f8f9ff;
            border-color: #667eea;
        }

        .portfolio-accordion-header.active {
            border-color: #667eea;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            margin-bottom: 0;
        }

        .portfolio-accordion-left {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .portfolio-accordion-toggle {
            font-size: 0.8rem;
            color: #667eea;
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .portfolio-accordion-header.active .portfolio-accordion-toggle {
            transform: rotate(90deg);
        }

        .portfolio-accordion-name {
            font-weight: 600;
            color: #333;
            font-size: 1rem;
            line-height: 1.5;
        }

        .portfolio-accordion-symbol {
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 600;
            background: #667eea;
            color: #fff;
            white-space: nowrap;
        }

        .portfolio-accordion-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .portfolio-accordion-amount {
            font-size: 0.85rem;
            color: #666;
            white-space: nowrap;
        }

        .portfolio-accordion-profit {
            font-weight: 600;
            font-size: 0.9rem;
            padding: 3px 8px;
            border-radius: 6px;
            background: #f0f4ff;
        }

        .portfolio-accordion-rate {
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .portfolio-header-progress {
            display: flex;
            align-items: center;
        }

        .portfolio-header-progress-bar {
            width: 50px;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .portfolio-header-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
        }

        .portfolio-accordion-content {
            display: none;
            background: #fff;
            border: 1px solid #667eea;
            border-top: none;
            border-radius: 0 0 10px 10px;
            padding: 15px;
            margin-bottom: 8px;
        }

        .portfolio-accordion-content.active {
            display: block;
        }

        .portfolio-detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .portfolio-detail-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .portfolio-detail-item.full-width {
            grid-column: 1 / -1;
        }

        .portfolio-detail-label {
            font-size: 0.7rem;
            color: #888;
            margin-bottom: 4px;
        }

        .portfolio-detail-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
        }

        .portfolio-progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 6px;
        }

        .portfolio-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .portfolio-accordion-header {
                padding: 16px 14px;
            }

            .portfolio-accordion-left {
                gap: 8px;
            }

            .portfolio-accordion-right {
                gap: 10px;
            }

            .portfolio-accordion-name {
                font-size: 0.9rem;
            }

            .portfolio-accordion-symbol {
                font-size: 0.65rem;
                padding: 2px 6px;
            }

            .portfolio-accordion-profit {
                font-size: 0.8rem;
            }

            .portfolio-accordion-rate {
                font-size: 0.75rem;
            }

            .portfolio-accordion-amount {
                display: none;
            }

            .portfolio-header-progress-bar {
                width: 40px;
                height: 5px;
            }
        }

        @media (max-width: 480px) {
            .portfolio-accordion-header {
                padding: 14px 12px;
            }

            .portfolio-accordion-left {
                gap: 6px;
            }

            .portfolio-accordion-right {
                gap: 8px;
            }

            .portfolio-accordion-name {
                font-size: 0.85rem;
            }

            .portfolio-accordion-symbol {
                font-size: 0.6rem;
                padding: 2px 5px;
            }

            .portfolio-accordion-profit {
                font-size: 0.7rem;
            }

            .portfolio-accordion-rate {
                font-size: 0.7rem;
            }

            .portfolio-header-progress-bar {
                width: 35px;
                height: 4px;
            }
        }

        @media (max-width: 768px) {
            .logout-btn {
                font-size: 0.85em;
                padding: 8px 16px;
            }

            .side-menu {
                width: 260px;
                left: -300px;
            }

            .hamburger-btn {
                width: 26px;
                height: 26px;
            }

            .hamburger-btn span {
                width: 26px;
            }

            /* Í±∞Îûò Ïπ¥Îìú Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .trade-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .trade-time {
                font-size: 0.75em;
            }
        }

        @media (max-width: 480px) {
            .logout-btn {
                font-size: 0.8em;
                padding: 6px 14px;
            }

            .side-menu {
                width: 240px;
                left: -280px;
            }

            .hamburger-btn {
                width: 24px;
                height: 24px;
            }

            .hamburger-btn span {
                width: 24px;
                height: 2.5px;
            }

            .side-menu-header h2 {
                font-size: 1.1em;
            }

            .side-menu-item {
                padding: 14px 16px;
            }

            .side-menu-icon {
                font-size: 1.5em;
            }

            .side-menu-title {
                font-size: 0.95em;
            }

            .side-menu-desc {
                font-size: 0.75em;
            }
        }
    </style>
</head>
<body>
    <!-- ÏàòÏùµ Ï∂ïÌïò Î™®Îã¨ -->
    <div id="profitModal" class="profit-modal hidden">
        <div class="profit-modal-content">
            <div id="profitEmoji" class="profit-emoji">üéâ</div>
            <div class="profit-modal-text">
                <h2 class="profit-title" id="profitTitle">üéâ Ï∂ïÌïòÌï©ÎãàÎã§! üéâ</h2>
                <p class="profit-message">Ïò§Îäò ÏàòÏùµ</p>
                <p class="profit-amount" id="profitAmountKRW">‚Ç©0</p>
                <p class="profit-amount-sub" id="profitAmountUSD">$0.00</p>
            </div>
        </div>
        <button class="profit-modal-close" onclick="closeProfitModal()">Îã´Í∏∞ ‚úï</button>
    </div>

    <!-- Î°úÍ∑∏Ïù∏ Ìèº (ÎØ∏Ïù∏Ï¶ù Ïãú) -->
    <div id="loginContainer" class="login-container hidden">
        <div class="login-header">
            <h2>üîê Î°úÍ∑∏Ïù∏</h2>
            <p>EggMoneyÏóê Ï†ëÍ∑ºÌïòÎ†§Î©¥ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</p>
        </div>

        <div id="errorMessage" class="error-message"></div>

        <form id="loginForm">
            <div class="form-group">
                <label for="password">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                <input type="password" id="password" name="password" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required autofocus>
            </div>
            <button type="submit" class="login-btn">Î°úÍ∑∏Ïù∏</button>
        </form>
    </div>

    <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† (Ïù∏Ï¶ù ÌõÑ) -->
    <div id="mainContainer" class="hidden">
        <div class="bot-container" style="max-width: 800px; padding-bottom: 100px;">
            <!-- ÌéòÏù¥ÏßÄ Ìó§Îçî + ÌñÑÎ≤ÑÍ±∞ Î©îÎâ¥ + Î°úÍ∑∏ÏïÑÏõÉ -->
            <div class="page-header" style="display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; padding: 15px 20px;">
                <!-- ÏôºÏ™Ω: ÌñÑÎ≤ÑÍ±∞ Î≤ÑÌäº -->
                <div style="justify-self: start;">
                    <button id="hamburgerBtn" class="hamburger-btn" aria-label="Î©îÎâ¥ Ïó¥Í∏∞">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>

                <!-- Í∞ÄÏö¥Îç∞: ÌÉÄÏù¥ÌãÄ -->
                <div class="page-title" style="text-align: center;">
                    <h1 style="margin: 0;">üè† EggMoney</h1>
                </div>

                <!-- Ïò§Î•∏Ï™Ω: Î°úÍ∑∏ÏïÑÏõÉ Î≤ÑÌäº -->
                <div style="justify-self: end;">
                    <button id="logoutBtn" class="logout-btn">Î°úÍ∑∏ÏïÑÏõÉ</button>
                </div>
            </div>

            <!-- ÏñºÎüø Î©îÏãúÏßÄ ÏÑπÏÖò -->
            {% if overview and (overview.alert_low_balance or overview.alert_high_balance) %}
            <div class="alert-section">
                {% if overview.alert_low_balance %}
                <div class="alert-card alert-warning">
                    <div class="alert-icon">üö®</div>
                    <div class="alert-content">
                        <div class="alert-title">ÏòàÏàòÍ∏à Î∂ÄÏ°±</div>
                        <div class="alert-message">ÏòàÏàòÍ∏àÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§. Ï∂©Ï†ÑÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.</div>
                        <div class="alert-detail">ÌòÑÏû¨ ÏòàÏàòÍ∏à: ${{ '{:,.0f}'.format(overview.hantoo_balance) }} / ÌïÑÏöî ÏãúÎìú: ${{ '{:,.0f}'.format(overview.seed_per_tier * 2) }}</div>
                    </div>
                </div>
                {% endif %}
                {% if overview.alert_high_balance %}
                <div class="alert-card alert-info">
                    <div class="alert-icon">üí∞</div>
                    <div class="alert-content">
                        <div class="alert-title">ÏòàÏàòÍ∏à Í≥ºÎã§</div>
                        <div class="alert-message">ÏòàÏàòÍ∏àÏù¥ $10,000ÏùÑ Ï¥àÍ≥ºÌñàÏäµÎãàÎã§. RP Îß§ÏàòÎ•º Í∂åÏû•Ìï©ÎãàÎã§.</div>
                        <div class="alert-detail">ÌòÑÏû¨ ÏòàÏàòÍ∏à: ${{ '{:,.0f}'.format(overview.hantoo_balance) }}</div>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏöîÏïΩ ÏÑπÏÖò -->
            {% if overview %}
            {% set seed_usage_rate = (overview.total_buy / overview.total_max_seed * 100) if overview.total_max_seed > 0 else 0 %}
            {% set dynamic_seed_usage_rate = (overview.total_buy / overview.total_dynamic_max_seed * 100) if overview.total_dynamic_max_seed > 0 else 0 %}
            {% set show_dynamic_progress = overview.total_dynamic_max_seed > 0 and overview.total_dynamic_max_seed != overview.total_max_seed %}
            <div>
                <div class="card-section">
                    <div class="section-title">üìä Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ <span style="font-size: 0.8em; color: #999;">({{ admin }})</span></div>

                    <div class="info-card">
                    <!-- ÌòÑÏû¨ ÏàòÏùµ (Î©îÏù∏) -->
                    <div style="text-align: center; padding-bottom: 18px; margin-bottom: 18px; border-bottom: 1px solid #eee;">
                        <div style="font-size: 0.8em; color: #888; margin-bottom: 6px;">ÌòÑÏû¨ ÏàòÏùµ</div>
                        <div style="font-size: 1.8em; font-weight: 700; color: {% if overview.current_profit >= 0 %}#c62828{% else %}#1565c0{% endif %};">
                            {% if overview.current_profit >= 0 %}+{% endif %}{{ '{:,.0f}'.format(overview.current_profit * overview.usd_krw) }}Ïõê
                        </div>
                        <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 4px;">
                            <span style="font-size: 0.95em; font-weight: 600; color: {% if overview.current_profit >= 0 %}#d32f2f{% else %}#1976d2{% endif %};">
                                {% if overview.profit_rate >= 0 %}+{% endif %}{{ '{:.2f}'.format(overview.profit_rate) }}%
                            </span>
                            <span style="color: #ccc;">|</span>
                            <span style="font-size: 0.85em; color: {% if overview.current_profit >= 0 %}#d32f2f{% else %}#1976d2{% endif %};">
                                {% if overview.current_profit >= 0 %}+{% endif %}$ {{ '{:,.2f}'.format(overview.current_profit) }}
                            </span>
                        </div>
                    </div>

                    <!-- Ï¥ù ÏûêÏÇ∞ -->
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 12px; margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.8em; color: #666;">Ï¥ù ÏûêÏÇ∞</span>
                            <div style="text-align: right;">
                                <span style="font-size: 1em; font-weight: 600; color: #333;">{{ '{:,.0f}'.format(overview.total_balance * overview.usd_krw) }}Ïõê</span>
                                <span style="font-size: 0.75em; color: #999; margin-left: 4px;">$ {{ '{:,.2f}'.format(overview.total_balance) }}</span>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px; padding-top: 8px; border-top: 1px solid #e0e0e0;">
                            <span style="font-size: 0.8em; color: #666;">ÏòàÏàòÍ∏à</span>
                            <div style="text-align: right;">
                                <span style="font-size: 0.9em; font-weight: 500; color: #667eea;">$ {{ '{:,.2f}'.format(overview.hantoo_balance) }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- ÏãúÎìú ÏÜåÏßÑÎ•† -->
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 12px; margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="background: #667eea; color: #fff; padding: 2px 8px; border-radius: 10px; font-size: 0.7em; font-weight: 600;">Î¥á {{ overview.active_bots }}/{{ overview.total_bots }}</span>
                            <span style="font-size: 0.8em; color: #666;">
                                <span style="font-weight: 600; color: #667eea;">{{ '{:.1f}'.format(seed_usage_rate) }}%</span> / {{ '{:,.0f}'.format(overview.total_max_seed * overview.usd_krw) }}Ïõê
                            </span>
                        </div>
                        <div style="background: #e0e0e0; border-radius: 6px; height: 10px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: {{ seed_usage_rate }}%; border-radius: 6px;"></div>
                        </div>
                        {% if show_dynamic_progress %}
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px; margin-bottom: 8px;">
                            <span style="background: #e67e22; color: #fff; padding: 2px 8px; border-radius: 10px; font-size: 0.7em; font-weight: 600;">ÎèôÏ†ÅÏãúÎìú</span>
                            <span style="font-size: 0.8em; color: #666;">
                                <span style="font-weight: 600; color: #e67e22;">{{ '{:.1f}'.format(dynamic_seed_usage_rate) }}%</span> / {{ '{:,.0f}'.format(overview.total_dynamic_max_seed * overview.usd_krw) }}Ïõê
                            </span>
                        </div>
                        <div style="background: #e0e0e0; border-radius: 6px; height: 10px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #e67e22, #f39c12); height: 100%; width: {{ dynamic_seed_usage_rate }}%; border-radius: 6px;"></div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Ìà¨Ïûê ÌòÑÌô© -->
                    <div style="display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 8px;">
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 10px; text-align: center;">
                            <div style="font-size: 0.7em; color: #888; margin-bottom: 2px;">Ìà¨ÏûêÏõêÍ∏à</div>
                            <div style="font-size: 1em; font-weight: 600; color: #333;">{{ '{:,.0f}'.format(overview.total_buy * overview.usd_krw) }}Ïõê</div>
                        </div>
                        <div style="font-size: 1em; color: {% if overview.current_profit >= 0 %}#c62828{% else %}#1565c0{% endif %};">
                            {% if overview.current_profit >= 0 %}‚ñ∂{% else %}‚óÄ{% endif %}
                        </div>
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 10px; text-align: center;">
                            <div style="font-size: 0.7em; color: #888; margin-bottom: 2px;">ÌòÑÏû¨Í∞ÄÏπò</div>
                            <div style="font-size: 1em; font-weight: 600; color: #333;">{{ '{:,.0f}'.format(overview.invest * overview.usd_krw) }}Ïõê</div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            {% endif %}

            <!-- Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Î¶¨Ïä§Ìä∏ ÏÑπÏÖò -->
            {% if trade_list %}
            <div>
                <div class="card-section">
                    <div class="section-title">üíº Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ({{ trade_list|selectattr('symbol', 'ne', 'RP')|list|length }}Í∞ú)</div>

                    {% for trade in trade_list if trade.symbol != 'RP' %}
                    {% set status = trade_status_map.get(trade.name) %}
                    {% set dynamic_status = dynamic_trade_status_map.get(trade.name) %}
                    <!-- Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏïÑÏΩîÎîîÏñ∏ Ìó§Îçî -->
                    <div class="portfolio-accordion-header" data-portfolio-header="{{ trade.name }}" onclick="togglePortfolioAccordion('{{ trade.name }}')">
                        <div class="portfolio-accordion-left">
                            <span class="portfolio-accordion-toggle">‚ñ∂</span>
                            <span class="portfolio-accordion-name">{{ trade.name }}</span>
                            <span class="portfolio-accordion-symbol">{{ trade.symbol }}</span>
                        </div>
                        <div class="portfolio-accordion-right">
                            <span class="portfolio-accordion-amount">{{ '{:,.0f}'.format(trade.amount) if trade.amount else '0' }}Ï£º</span>
                            {% if status and trade.amount > 0 and trade.name != 'RP' %}
                            <span class="portfolio-accordion-profit {{ 'profit-positive' if status.profit >= 0 else 'profit-negative' }}">
                                {% if status.profit >= 0 %}+{% endif %}${{ '{:,.2f}'.format(status.profit) }}
                            </span>
                            <span class="portfolio-accordion-rate {{ 'profit-positive' if status.profit_rate >= 0 else 'profit-negative' }}">
                                ({% if status.profit_rate >= 0 %}+{% endif %}{{ '{:.1f}'.format(status.profit_rate) }}%)
                            </span>
                            <div class="portfolio-header-progress">
                                <div class="portfolio-header-progress-bar">
                                    <div class="portfolio-header-progress-fill" style="width: {{ status.progress_rate }}%;"></div>
                                </div>
                            </div>
                            {% else %}
                            <span class="portfolio-accordion-profit">${{ '{:,.2f}'.format(trade.total_price) if trade.total_price else '0' }}</span>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏïÑÏΩîÎîîÏñ∏ Ïª®ÌÖêÏ∏† -->
                    <div class="portfolio-accordion-content" data-portfolio-content="{{ trade.name }}">
                        <div class="portfolio-detail-grid">
                            {% if status and trade.amount > 0 and trade.name != 'RP' %}
                            <div class="portfolio-detail-item">
                                <div class="portfolio-detail-label">ÌòÑÏû¨Í∞Ä</div>
                                <div class="portfolio-detail-value">${{ '{:,.2f}'.format(status.cur_price) }}</div>
                            </div>
                            <div class="portfolio-detail-item">
                                <div class="portfolio-detail-label">ÌèâÍ∑† Îß§ÏàòÍ∞Ä</div>
                                <div class="portfolio-detail-value">${{ '{:,.2f}'.format(status.cur_trade.purchase_price) }}</div>
                            </div>
                            <div class="portfolio-detail-item">
                                <div class="portfolio-detail-label">ÏàòÎüâ</div>
                                <div class="portfolio-detail-value">{{ '{:,.0f}'.format(trade.amount) if trade.amount else '0' }}Ï£º</div>
                            </div>
                            <div class="portfolio-detail-item">
                                <div class="portfolio-detail-label">Ï¥ùÏï°</div>
                                <div class="portfolio-detail-value">${{ '{:,.2f}'.format(trade.total_price) if trade.total_price else '0' }}</div>
                            </div>
                            <div class="portfolio-detail-item">
                                <div class="portfolio-detail-label">ÏàòÏùµÍ∏à</div>
                                <div class="portfolio-detail-value {{ 'profit-positive' if status.profit >= 0 else 'profit-negative' }}">
                                    {% if status.profit >= 0 %}+{% endif %}${{ '{:,.2f}'.format(status.profit) }}
                                </div>
                            </div>
                            <div class="portfolio-detail-item">
                                <div class="portfolio-detail-label">ÏàòÏùµÎ•†</div>
                                <div class="portfolio-detail-value {{ 'profit-positive' if status.profit_rate >= 0 else 'profit-negative' }}">
                                    {% if status.profit_rate >= 0 %}+{% endif %}{{ '{:.2f}'.format(status.profit_rate) }}%
                                </div>
                            </div>
                            <div class="portfolio-detail-item">
                                <div class="portfolio-detail-label">%ÏßÄÏ†ê</div>
                                <div class="portfolio-detail-value" style="color: #e67e22;">{{ '{:.1f}'.format(status.point * 100) }}% <span style="font-size: 0.8em; color: #888;">(${{ '{:,.2f}'.format(status.point_price) }})</span></div>
                            </div>
                            <div class="portfolio-detail-item">
                                <div class="portfolio-detail-label">ÏÇ¨Ïù¥ÌÅ¥ ÎàÑÏ†Å ÏÜêÏùµ</div>
                                <div class="portfolio-detail-value {{ 'profit-positive' if sell_profit_map.get(trade.name, 0) >= 0 else 'profit-negative' }}">
                                    {% if sell_profit_map.get(trade.name, 0) >= 0 %}+{% endif %}${{ '{:,.2f}'.format(sell_profit_map.get(trade.name, 0)) }}
                                </div>
                            </div>
                            <div class="portfolio-detail-item">
                                <div class="portfolio-detail-label">ÏãúÎìú ÏÜåÏßÑÏú®</div>
                                <div class="portfolio-detail-value" style="display: flex; align-items: center; gap: 8px; justify-content: center;">
                                    <span style="color: #667eea; font-weight: 600;">{{ '{:.1f}'.format(status.progress_rate) }}%</span>
                                    <div class="portfolio-progress-bar" style="flex: 1; max-width: 80px; margin: 0;">
                                        <div class="portfolio-progress-fill" style="width: {{ status.progress_rate }}%;"></div>
                                    </div>
                                    <span style="color: #888; font-size: 0.8em;">${{ '{:,.0f}'.format(status.max_seed) }}</span>
                                </div>
                            </div>
                            <div class="portfolio-detail-item">
                                <div class="portfolio-detail-label">ÎèôÏ†ÅÏãúÎìú ÏÜåÏßÑÏú®</div>
                                {% if dynamic_status %}
                                <div class="portfolio-detail-value" style="display: flex; align-items: center; gap: 8px; justify-content: center;">
                                    <span style="color: #e67e22; font-weight: 600;">{{ '{:.1f}'.format(dynamic_status.progress_rate) }}%</span>
                                    <div class="portfolio-progress-bar" style="flex: 1; max-width: 80px; margin: 0;">
                                        <div class="portfolio-progress-fill" style="width: {{ dynamic_status.progress_rate }}%; background: linear-gradient(90deg, #e67e22, #f39c12);"></div>
                                    </div>
                                    <span style="color: #888; font-size: 0.8em;">${{ '{:,.0f}'.format(dynamic_status.max_seed) }}</span>
                                </div>
                                {% else %}
                                <div class="portfolio-detail-value" style="color: #888;">-</div>
                                {% endif %}
                            </div>
                            {% else %}
                            <div class="portfolio-detail-item">
                                <div class="portfolio-detail-label">Íµ¨Îß§Í∞Ä</div>
                                <div class="portfolio-detail-value">${{ '{:,.2f}'.format(trade.purchase_price) if trade.purchase_price else '0' }}</div>
                            </div>
                            <div class="portfolio-detail-item">
                                <div class="portfolio-detail-label">ÏàòÎüâ</div>
                                <div class="portfolio-detail-value">{{ '{:,.0f}'.format(trade.amount) if trade.amount else '0' }}Ï£º</div>
                            </div>
                            <div class="portfolio-detail-item full-width">
                                <div class="portfolio-detail-label">Ï¥ùÏï°</div>
                                <div class="portfolio-detail-value">${{ '{:,.2f}'.format(trade.total_price) if trade.total_price else '0' }}</div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Í±∞Îûò ÎÇ¥Ïó≠ ÏÑπÏÖò (ÎÇ†Ïßú ÏÑ†ÌÉù) -->
            <div>
                <div class="card-section">
                    <div class="section-title" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                        <div>
                            üìä Í±∞Îûò ÎÇ¥Ïó≠
                            <span id="tradesCountDisplay" style="font-size: 0.8em; color: #999; font-weight: 400;"></span>
                        </div>
                        <!-- ÎÇ†Ïßú ÏÑ†ÌÉù Î≤ÑÌäº -->
                        <button class="date-select-btn" onclick="openDateModal()">
                            <span id="selectedDateDisplay">Ïò§Îäò</span>
                            <span class="date-select-icon">üìÖ</span>
                        </button>
                    </div>

                    <!-- Í±∞Îûò ÎÇ¥Ïó≠ Ïª®ÌÖåÏù¥ÎÑà (ÎèôÏ†Å Î°úÎî©) -->
                    <div id="tradesContainer">
                        <div class="trades-loading">Î°úÎî© Ï§ë...</div>
                    </div>

                    <!-- Í±∞Îûò ÏóÜÏùå Î©îÏãúÏßÄ -->
                    <div id="noTradesMessage" class="no-trades-message" style="display: none;">
                        ÏÑ†ÌÉùÌïú Í∏∞Í∞ÑÏóê Í±∞Îûò ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.
                    </div>
                </div>
            </div>

            <!-- ÎÇ†Ïßú ÏÑ†ÌÉù Î™®Îã¨ -->
            <div id="datePickerModal" class="date-modal-overlay">
                <div class="date-modal-card">
                    <div class="date-modal-header">
                        <span class="date-modal-title">üìÖ Í∏∞Í∞Ñ ÏÑ†ÌÉù</span>
                        <button class="date-modal-close" onclick="closeDateModal()">&times;</button>
                    </div>
                    <div class="date-modal-body">
                        <!-- ÌîÑÎ¶¨ÏÖã Î≤ÑÌäº -->
                        <div class="date-picker-presets">
                            <button class="date-preset-btn active" data-preset="today">Ïò§Îäò</button>
                            <button class="date-preset-btn" data-preset="week">1Ï£ºÏùº</button>
                            <button class="date-preset-btn" data-preset="month">1Í∞úÏõî</button>
                            <button class="date-preset-btn" data-preset="all">Ï†ÑÏ≤¥</button>
                        </div>
                        <!-- ÏßÅÏ†ë ÏÑ†ÌÉù -->
                        <div class="date-picker-row">
                            <div class="date-picker-field">
                                <label>ÏãúÏûëÏùº</label>
                                <input type="date" id="startDate">
                            </div>
                            <div class="date-picker-field">
                                <label>Ï¢ÖÎ£åÏùº</label>
                                <input type="date" id="endDate">
                            </div>
                        </div>
                    </div>
                    <div class="date-modal-actions">
                        <button class="date-modal-btn-cancel" onclick="closeDateModal()">Ï∑®ÏÜå</button>
                        <button class="date-modal-btn-submit" onclick="applyDateSelection()">Ï†ÅÏö©</button>
                    </div>
                </div>
            </div>

            <!-- ÌñÑÎ≤ÑÍ±∞ ÏÇ¨Ïù¥Îìú Î©îÎâ¥ -->
            <div id="sideMenu" class="side-menu">
                <div class="side-menu-header">
                    <h2>üìã Î©îÎâ¥</h2>
                    <button id="closeMenuBtn" class="close-menu-btn">&times;</button>
                </div>
                <nav class="side-menu-nav">
                    <a href="/bot_info" class="side-menu-item">
                        <div class="side-menu-icon">ü§ñ</div>
                        <div class="side-menu-text">
                            <div class="side-menu-title">Î¥á Ï†ïÎ≥¥ Í¥ÄÎ¶¨</div>
                        </div>
                    </a>
                    <a href="/trade" class="side-menu-item">
                        <div class="side-menu-icon">üìà</div>
                        <div class="side-menu-text">
                            <div class="side-menu-title">Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Í¥ÄÎ¶¨</div>
                        </div>
                    </a>
                    <a href="/history" class="side-menu-item">
                        <div class="side-menu-icon">üìú</div>
                        <div class="side-menu-text">
                            <div class="side-menu-title">Í±∞Îûò ÎÇ¥Ïó≠</div>
                        </div>
                    </a>
                </nav>
            </div>

            <!-- Ïò§Î≤ÑÎ†àÏù¥ Î∞∞Í≤Ω -->
            <div id="menuOverlay" class="menu-overlay"></div>


            <!-- ÏãúÏû• ÏßÄÌëú Ï∞®Ìä∏ ÏÑπÏÖò -->
            <div>
                <div class="card-section">
                    <div class="section-title" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                        <div>
                            üìâ ÏãúÏû• ÏßÄÌëú (30Ïùº) <span style="font-size: 0.7em; color: #999; font-weight: 400;">ÏÉùÏÑ±Îêú Î¥á Ìã∞Ïª§Îßå Ï°∞Ìöå</span>
                        </div>
                        <!-- Í∞ïÏ†ú Î¶¨ÌîÑÎ†àÏãú Î≤ÑÌäº -->
                        <button id="refreshMarketBtn" class="refresh-market-btn" onclick="refreshMarketIndicator()">
                            <span class="refresh-icon">üîÑ</span>
                            <span class="refresh-text">Í∞±Ïã†</span>
                        </button>
                    </div>

                    <!-- VIX ÏïÑÏΩîÎîîÏñ∏ -->
                    <div class="ticker-accordion-header" id="vixAccordionHeader" onclick="toggleVixAccordion()">
                        <div class="ticker-accordion-left">
                            <span class="ticker-accordion-toggle">‚ñ∂</span>
                            <span class="ticker-accordion-name">VIX</span>
                            <span class="ticker-accordion-emoji" id="vixEmoji"></span>
                            <span class="ticker-accordion-badge" id="vixBadge">-</span>
                            <span class="ticker-value-highlight" id="vixCurrentDisplay">Î°úÎî©Ï§ë...</span>
                        </div>
                        <div class="ticker-accordion-right">
                            <span class="ticker-price-value" style="visibility: hidden;">-</span>
                        </div>
                    </div>
                    <div class="ticker-accordion-content" id="vixAccordionContent">
                        <div class="ticker-chart-container">
                            <canvas id="vixChart"></canvas>
                        </div>
                    </div>

                    <!-- Ìã∞Ïª§Î≥Ñ Ï∞®Ìä∏ (Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞) -->
                    <div id="tickerChartsContainer">
                        <!-- JavaScriptÏóêÏÑú ÎèôÏ†Å ÏÉùÏÑ± -->
                    </div>
                </div>
            </div>

            <style>
                /* Ìã∞Ïª§ ÏïÑÏΩîÎîîÏñ∏ Ïä§ÌÉÄÏùº */
                .ticker-accordion-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 18px 18px;
                    background: #fff;
                    border: 1px solid #e0e0e0;
                    border-radius: 10px;
                    margin-bottom: 8px;
                    cursor: pointer;
                    transition: all 0.2s;
                }

                .ticker-accordion-header:hover {
                    background: #f8f9ff;
                    border-color: #667eea;
                }

                .ticker-accordion-header.active {
                    border-color: #667eea;
                    border-bottom-left-radius: 0;
                    border-bottom-right-radius: 0;
                    margin-bottom: 0;
                }

                .ticker-accordion-left {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    flex: 1;
                }

                .ticker-accordion-toggle {
                    font-size: 0.8rem;
                    color: #667eea;
                    transition: transform 0.2s;
                    flex-shrink: 0;
                }

                .ticker-accordion-header.active .ticker-accordion-toggle {
                    transform: rotate(90deg);
                }

                .ticker-accordion-name {
                    font-weight: 600;
                    color: #333;
                    font-size: 1rem;
                    line-height: 1.5;
                }

                .ticker-accordion-badge {
                    padding: 3px 8px;
                    border-radius: 5px;
                    font-size: 0.7rem;
                    font-weight: 600;
                    background: #667eea;
                    color: #fff;
                    white-space: nowrap;
                }

                .ticker-accordion-emoji {
                    font-size: 1rem;
                }

                .ticker-accordion-badge.fear {
                    background: #c62828;
                    color: #fff;
                }

                .ticker-accordion-badge.greed {
                    background: #2e7d32;
                    color: #fff;
                }

                .ticker-accordion-badge.neutral {
                    background: #f57f17;
                    color: #fff;
                }

                /* MA Î†àÎ≤®Î≥Ñ ÏÉâÏÉÅ */
                .ticker-accordion-badge.ma-badge.strong-uptrend {
                    background: #1565c0;
                    color: #fff;
                }

                .ticker-accordion-badge.ma-badge.weak-uptrend {
                    background: #42a5f5;
                    color: #fff;
                }

                .ticker-accordion-badge.ma-badge.weak-downtrend {
                    background: #ff9800;
                    color: #fff;
                }

                .ticker-accordion-badge.ma-badge.strong-downtrend {
                    background: #d32f2f;
                    color: #fff;
                }

                .ticker-accordion-right {
                    display: flex;
                    align-items: center;
                    gap: 12px;
                }

                .ticker-accordion-value {
                    font-weight: 700;
                    color: #333;
                    font-size: 0.9rem;
                }

                /* Í∞ïÏ°∞ ÌëúÏãú Ïä§ÌÉÄÏùº */
                .ticker-value-highlight {
                    font-weight: 600;
                    font-size: 0.9rem;
                    padding: 3px 8px;
                    border-radius: 6px;
                    background: #f0f4ff;
                }

                .ticker-value-highlight.fear {
                    background: #ffebee;
                    color: #c62828;
                }

                .ticker-value-highlight.greed {
                    background: #e8f5e9;
                    color: #2e7d32;
                }

                .ticker-value-highlight.neutral {
                    background: #fff8e1;
                    color: #f57f17;
                }

                .ticker-price-value {
                    font-weight: 600;
                    font-size: 0.85rem;
                    color: #2e7d32;
                }

                .ticker-accordion-content {
                    display: none;
                    background: #fff;
                    border: 1px solid #667eea;
                    border-top: none;
                    border-radius: 0 0 10px 10px;
                    padding: 15px;
                    margin-bottom: 8px;
                }

                .ticker-accordion-content.active {
                    display: block;
                }

                .ticker-chart-container {
                    height: 180px;
                    margin-bottom: 10px;
                }

                .ticker-chart-container:last-child {
                    margin-bottom: 0;
                }

                .ticker-chart-label {
                    font-size: 0.85em;
                    color: #666;
                    margin-bottom: 8px;
                    font-weight: 500;
                }

                /* Ïù¥ÌèâÏÑ† ÎßâÎåÄ Í∑∏ÎûòÌîÑ */
                .ma-trend-container {
                    margin-bottom: 20px;
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 8px;
                }

                .ma-bars-container {
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                }

                .ma-bar-row {
                    display: flex;
                    align-items: center;
                    gap: 12px;
                }

                .ma-bar-label {
                    min-width: 60px;
                    font-size: 0.85em;
                    color: #555;
                    font-weight: 600;
                    text-align: right;
                }

                .ma-bar-wrapper {
                    flex: 1;
                    background: #e9ecef;
                    border-radius: 6px;
                    overflow: hidden;
                    height: 32px;
                    position: relative;
                }

                .ma-bar {
                    height: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: flex-end;
                    padding-right: 10px;
                    transition: width 0.4s ease;
                    border-radius: 6px;
                    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
                }

                .ma-bar-value {
                    font-size: 0.85em;
                    color: white;
                    font-weight: 700;
                    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
                }

                .ma-trend-summary {
                    margin-top: 15px;
                    padding: 12px 16px;
                    background: white;
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                    border: 2px solid #dee2e6;
                }

                .ma-trend-emoji {
                    font-size: 1.4em;
                }

                .ma-trend-text {
                    font-size: 0.95em;
                    color: #333;
                    font-weight: 700;
                }

                /* Ìã∞Ïª§ ÏïÑÏΩîÎîîÏñ∏ Î™®Î∞îÏùº Î∞òÏùëÌòï - Í∏∞Î≥∏ Ïä§ÌÉÄÏùº Îí§Ïóê ÏúÑÏπòÌï¥Ïïº Ìï® */
                @media (max-width: 768px) {
                    .ticker-accordion-header {
                        padding: 16px 14px;
                    }

                    .ticker-accordion-left {
                        gap: 8px;
                    }

                    .ticker-accordion-right {
                        gap: 10px;
                    }

                    .ticker-accordion-name {
                        font-size: 0.9rem;
                    }

                    .ticker-accordion-badge {
                        font-size: 0.65rem;
                        padding: 2px 6px;
                    }

                    .ticker-accordion-emoji {
                        font-size: 0.9rem;
                    }

                    .ticker-value-highlight {
                        font-size: 0.8rem;
                        padding: 2px 6px;
                    }

                    .ticker-price-value {
                        font-size: 0.75rem;
                    }
                }

                @media (max-width: 480px) {
                    .ticker-accordion-header {
                        padding: 14px 12px;
                    }

                    .ticker-accordion-left {
                        gap: 6px;
                    }

                    .ticker-accordion-right {
                        gap: 8px;
                    }

                    .ticker-accordion-name {
                        font-size: 0.85rem;
                    }

                    .ticker-accordion-badge {
                        font-size: 0.6rem;
                        padding: 2px 5px;
                    }

                    .ticker-accordion-emoji {
                        font-size: 0.85rem;
                    }

                    .ticker-value-highlight {
                        font-size: 0.7rem;
                        padding: 2px 5px;
                    }

                    .ticker-price-value {
                        font-size: 0.7rem;
                    }
                }

                /* ÏãúÏû• ÏßÄÌëú Î¶¨ÌîÑÎ†àÏãú Î≤ÑÌäº Ïä§ÌÉÄÏùº */
                .refresh-market-btn {
                    display: flex;
                    align-items: center;
                    gap: 4px;
                    padding: 6px 12px;
                    border: 1px solid #e67e22;
                    border-radius: 20px;
                    background: #fff;
                    font-size: 0.8rem;
                    color: #e67e22;
                    cursor: pointer;
                    transition: all 0.2s;
                    font-weight: 500;
                }

                .refresh-market-btn:hover {
                    background: #fef5e7;
                    border-color: #d35400;
                    color: #d35400;
                }

                .refresh-market-btn:disabled {
                    opacity: 0.6;
                    cursor: not-allowed;
                }

                .refresh-market-btn .refresh-icon {
                    font-size: 0.9rem;
                    transition: transform 0.3s;
                }

                .refresh-market-btn.loading .refresh-icon {
                    animation: spin 1s linear infinite;
                }

                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }

                @media (max-width: 480px) {
                    .refresh-market-btn {
                        padding: 5px 10px;
                        font-size: 0.75rem;
                    }
                }

            </style>
        </div>
    </div>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ïù∏Ï¶ù ÏÉÅÌÉú ÌôïÏù∏
        async function checkAuth() {
            try {
                const response = await fetch('/check_auth');
                const data = await response.json();

                if (data.authenticated) {
                    showMainContainer();
                } else {
                    showLoginContainer();
                }
            } catch (error) {
                console.error('Ïù∏Ï¶ù ÏÉÅÌÉú ÌôïÏù∏ Ïã§Ìå®:', error);
                showLoginContainer();
            }
        }

        // Î°úÍ∑∏Ïù∏ Ìèº Ï†úÏ∂ú
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');

            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ password: password })
                });

                const data = await response.json();

                if (data.success) {
                    // Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ Ïãú Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Ï¥àÍ∏∞Ìôî
                    localStorage.removeItem('profitModalShown');
                    showMainContainer();
                } else {
                    errorMessage.textContent = data.error || 'Î°úÍ∑∏Ïù∏ Ïã§Ìå®';
                    errorMessage.classList.add('show');
                    document.getElementById('password').value = '';
                }
            } catch (error) {
                errorMessage.textContent = 'ÏÑúÎ≤Ñ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.';
                errorMessage.classList.add('show');
                console.error('Î°úÍ∑∏Ïù∏ Ïã§Ìå®:', error);
            }
        });

        // Î°úÍ∑∏ÏïÑÏõÉ
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                await fetch('/logout', { method: 'POST' });
                showLoginContainer();
            } catch (error) {
                console.error('Î°úÍ∑∏ÏïÑÏõÉ Ïã§Ìå®:', error);
            }
        });

        function showLoginContainer() {
            document.getElementById('loginContainer').classList.remove('hidden');
            document.getElementById('mainContainer').classList.add('hidden');
            document.getElementById('password').focus();
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ïù∏Ï¶ù ÌôïÏù∏
        checkAuth();

        // ===== ÏãúÏû• ÏßÄÌëú Ï∞®Ìä∏ =====
        let vixChart = null;
        let tickerCharts = {};  // Ìã∞Ïª§Î≥Ñ Ï∞®Ìä∏ Ï†ÄÏû•

        // Ï∞®Ìä∏ ÏÉâÏÉÅ
        const rsiColor = 'rgb(102, 126, 234)';   // ÌååÎûë
        const priceColor = 'rgb(40, 167, 69)';   // ÎÖπÏÉâ

        async function loadMarketHistory() {
            try {
                const response = await fetch('/api/market_history?days=30');
                if (!response.ok) {
                    console.error('ÏãúÏû• ÏßÄÌëú Î°úÎî© Ïã§Ìå®');
                    return;
                }

                const data = await response.json();
                renderVixChart(data.vix_history, data.vix_current);
                renderTickerCharts(data.rsi_history, data.price_history, data.rsi_current, data.ma_trend);

                // ÎßàÏßÄÎßâ Îç∞Ïù¥ÌÑ∞ ÎÇ†Ïßú ÌôïÏù∏ ÌõÑ Î¶¨ÌîÑÎ†àÏãú Î≤ÑÌäº ÌëúÏãú
                checkAndShowRefreshButton(data.last_data_date);
            } catch (error) {
                console.error('ÏãúÏû• ÏßÄÌëú Î°úÎî© Ïò§Î•ò:', error);
            }
        }

        // ÎßàÏßÄÎßâ Îç∞Ïù¥ÌÑ∞ ÎÇ†ÏßúÎ•º Î≤ÑÌäº Ìà¥ÌåÅÏóê ÌëúÏãú
        function checkAndShowRefreshButton(lastDataDate) {
            const refreshBtn = document.getElementById('refreshMarketBtn');
            if (lastDataDate) {
                refreshBtn.title = `ÎßàÏßÄÎßâ Îç∞Ïù¥ÌÑ∞: ${lastDataDate}`;
            }
        }

        // ÏãúÏû• ÏßÄÌëú Í∞ïÏ†ú Î¶¨ÌîÑÎ†àÏãú
        async function refreshMarketIndicator() {
            const refreshBtn = document.getElementById('refreshMarketBtn');
            refreshBtn.disabled = true;
            refreshBtn.classList.add('loading');

            try {
                const response = await fetch('/api/refresh_market_indicator', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                if (data.success) {
                    // Ï∫êÏãú ÏÇ≠Ï†ú ÌõÑ ÌéòÏù¥ÏßÄ Î¶¨Î°úÎìú
                    window.location.reload();
                } else {
                    console.error('ÏãúÏû• ÏßÄÌëú Í∞±Ïã† Ïã§Ìå®:', data.message);
                    alert('ÏãúÏû• ÏßÄÌëú Í∞±Ïã† Ïã§Ìå®: ' + data.message);
                }
            } catch (error) {
                console.error('ÏãúÏû• ÏßÄÌëú Í∞±Ïã† Ïò§Î•ò:', error);
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.classList.remove('loading');
            }
        }

        // VIX ÏïÑÏΩîÎîîÏñ∏ ÌÜ†Í∏Ä
        function toggleVixAccordion() {
            const header = document.getElementById('vixAccordionHeader');
            const content = document.getElementById('vixAccordionContent');

            if (header && content) {
                header.classList.toggle('active');
                content.classList.toggle('active');

                // ÌôïÏû• ÏÉÅÌÉú Ï†ÄÏû•
                const isExpanded = content.classList.contains('active');
                localStorage.setItem('vixExpanded', isExpanded);
            }
        }

        // Ìã∞Ïª§ ÏïÑÏΩîÎîîÏñ∏ ÌÜ†Í∏Ä
        function toggleTickerAccordion(ticker) {
            const header = document.querySelector(`[data-ticker-header="${ticker}"]`);
            const content = document.querySelector(`[data-ticker-content="${ticker}"]`);

            if (header && content) {
                const isExpanding = !content.classList.contains('active');
                header.classList.toggle('active');
                content.classList.toggle('active');

                // Ï∞®Ìä∏Í∞Ä Ï≤òÏùå Ïó¥Î¶¥ ÎïåÎßå Î†åÎçîÎßÅ
                if (isExpanding && !tickerCharts[ticker]) {
                    const rsiData = content.dataset.rsi ? JSON.parse(content.dataset.rsi) : null;
                    const priceData = content.dataset.price ? JSON.parse(content.dataset.price) : null;
                    renderSingleTickerChart(ticker, rsiData, priceData);
                }

                // ÌôïÏû• ÏÉÅÌÉú Ï†ÄÏû•
                saveTickerExpandedState(ticker, isExpanding);
            }
        }

        function saveTickerExpandedState(ticker, isExpanded) {
            let expandedTickers = JSON.parse(localStorage.getItem('expandedTickers') || '{}');
            expandedTickers[ticker] = isExpanded;
            localStorage.setItem('expandedTickers', JSON.stringify(expandedTickers));
        }

        function restoreTickerExpandedStates() {
            const expandedTickers = JSON.parse(localStorage.getItem('expandedTickers') || '{}');

            for (const ticker in expandedTickers) {
                if (expandedTickers[ticker]) {
                    const header = document.querySelector(`[data-ticker-header="${ticker}"]`);
                    const content = document.querySelector(`[data-ticker-content="${ticker}"]`);

                    if (header && content) {
                        header.classList.add('active');
                        content.classList.add('active');

                        // Ï∞®Ìä∏ Î†åÎçîÎßÅ
                        const rsiData = content.dataset.rsi ? JSON.parse(content.dataset.rsi) : null;
                        const priceData = content.dataset.price ? JSON.parse(content.dataset.price) : null;
                        const maData = content.dataset.ma ? JSON.parse(content.dataset.ma) : null;
                        renderSingleTickerChart(ticker, rsiData, priceData, maData);
                    }
                }
            }
        }

        function renderTickerCharts(rsiHistory, priceHistory, rsiCurrent, maTrend) {
            const container = document.getElementById('tickerChartsContainer');
            container.innerHTML = '';

            if (!rsiHistory && !priceHistory) return;

            // Í∏∞Î≥∏ Ìã∞Ïª§ (TQQQ, SOXL) + Î¥áÏóêÏÑú ÏÉùÏÑ±Îêú Ìã∞Ïª§
            const defaultTickers = ['TQQQ', 'SOXL'];
            const botTickers = new Set([
                ...Object.keys(rsiHistory || {}),
                ...Object.keys(priceHistory || {})
            ]);

            // Í∏∞Î≥∏ Ìã∞Ïª§Î•º Î®ºÏ†Ä, Í∑∏ Îã§Ïùå Î¥á Ìã∞Ïª§ (Í∏∞Î≥∏ Ìã∞Ïª§ Ï†úÏô∏)
            const tickers = [
                ...defaultTickers,
                ...[...botTickers].filter(t => !defaultTickers.includes(t))
            ];

            tickers.forEach(ticker => {
                const rsiData = rsiHistory ? rsiHistory[ticker] : null;
                const priceData = priceHistory ? priceHistory[ticker] : null;
                const maData = maTrend && maTrend[ticker] ? maTrend[ticker] : null;

                const currentPrice = priceData ? priceData[priceData.length - 1].value : '-';

                // ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏùÄ RSI Î†àÎ≤® Ï†ïÎ≥¥ ÏÇ¨Ïö©
                const tickerLevel = rsiCurrent && rsiCurrent[ticker] ? rsiCurrent[ticker] : null;
                const currentRsi = tickerLevel ? tickerLevel.value : '-';
                const rsiLevel = tickerLevel ? tickerLevel.level : '';
                const rsiEmoji = tickerLevel ? tickerLevel.emoji : '';
                const rsiClass = tickerLevel ? tickerLevel.css_class : '';

                // Ïù¥ÌèâÏÑ† Ï∂îÏÑ∏ Ï†ïÎ≥¥
                const maTrendInfo = maData && maData.trend ? maData.trend : null;
                const maTrendLevel = maTrendInfo ? maTrendInfo.level : '';
                const maTrendEmoji = maTrendInfo ? maTrendInfo.emoji : '';
                const maTrendClass = maTrendInfo ? maTrendInfo.css_class : '';

                // ÏïÑÏΩîÎîîÏñ∏ HTML ÏÉùÏÑ±
                const accordionHtml = `
                    <div class="ticker-accordion-header" data-ticker-header="${ticker}" onclick="toggleTickerAccordion('${ticker}')">
                        <div class="ticker-accordion-left">
                            <span class="ticker-accordion-toggle">‚ñ∂</span>
                            <span class="ticker-accordion-name">${ticker}</span>
                            <span class="ticker-accordion-emoji">${rsiEmoji}</span>
                            <span class="ticker-accordion-badge ${rsiClass}">${rsiLevel}</span>
                            <span class="ticker-value-highlight ${rsiClass}">RSI ${currentRsi}</span>
                            <span class="ticker-accordion-emoji" style="margin-left: 12px;">${maTrendEmoji}</span>
                            <span class="ticker-accordion-badge ma-badge ${maTrendClass}">${maTrendLevel}</span>
                        </div>
                        <div class="ticker-accordion-right">
                            <span class="ticker-price-value">$${currentPrice}</span>
                        </div>
                    </div>
                    <div class="ticker-accordion-content"
                         data-ticker-content="${ticker}"
                         data-rsi='${JSON.stringify(rsiData)}'
                         data-price='${JSON.stringify(priceData)}'
                         data-ma='${JSON.stringify(maData)}'>
                        <div class="ticker-chart-label">üìà RSI (14Ïùº)</div>
                        <div class="ticker-chart-container">
                            <canvas id="rsiChart_${ticker}"></canvas>
                        </div>
                        <div class="ticker-chart-label">üí∞ Í∞ÄÍ≤© ($)</div>
                        <div class="ticker-chart-container">
                            <canvas id="priceChart_${ticker}"></canvas>
                        </div>
                        <div class="ticker-chart-label">üìä Ïù¥ÎèôÌèâÍ∑†ÏÑ† Î∞∞Ïó¥ (30Ïùº)</div>
                        <div class="ticker-chart-container">
                            <canvas id="maChart_${ticker}"></canvas>
                        </div>
                    </div>
                `;

                container.insertAdjacentHTML('beforeend', accordionHtml);
            });

            // Ï†ÄÏû•Îêú ÌôïÏû• ÏÉÅÌÉú Î≥µÏõê
            restoreTickerExpandedStates();
        }

        function renderSingleTickerChart(ticker, rsiData, priceData, maData) {
            // Ïù¥ÎèôÌèâÍ∑†ÏÑ† Ï∞®Ìä∏ (30Ïùº)
            if (priceData && priceData.length > 0) {
                const maCtx = document.getElementById(`maChart_${ticker}`).getContext('2d');

                // ÏµúÍ∑º 30Ïùº Îç∞Ïù¥ÌÑ∞Îßå Ï∂îÏ∂ú
                const recentDays = 30;
                const startIndex = Math.max(0, priceData.length - recentDays);
                const recentPriceData = priceData.slice(startIndex);

                const maLabels = recentPriceData.map(d => d.date.slice(5));
                const priceValues = priceData.map(d => d.value);
                const recentPriceValues = recentPriceData.map(d => d.value);

                // Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î°ú Ïù¥ÎèôÌèâÍ∑† Í≥ÑÏÇ∞ ÌõÑ ÏµúÍ∑º 30ÏùºÎßå Ï∂îÏ∂ú
                const ma20Full = calculateMA(priceValues, 20);
                const ma60Full = calculateMA(priceValues, 60);
                const ma20Values = ma20Full.slice(startIndex);
                const ma60Values = ma60Full.slice(startIndex);

                const datasets = [
                    {
                        label: 'ÌòÑÏû¨Í∞Ä',
                        data: recentPriceValues,
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.05)',
                        fill: false,
                        tension: 0.3,
                        pointRadius: 0,
                        borderWidth: 2.5,
                    },
                    {
                        label: '20ÏùºÏÑ†',
                        data: ma20Values,
                        borderColor: '#667eea',
                        backgroundColor: 'transparent',
                        fill: false,
                        tension: 0.3,
                        pointRadius: 0,
                        borderWidth: 2,
                    },
                    {
                        label: '60ÏùºÏÑ†',
                        data: ma60Values,
                        borderColor: '#ff9800',
                        backgroundColor: 'transparent',
                        fill: false,
                        tension: 0.3,
                        pointRadius: 0,
                        borderWidth: 2,
                    }
                ];

                tickerCharts[`${ticker}_ma`] = new Chart(maCtx, {
                    type: 'line',
                    data: {
                        labels: maLabels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    font: { size: 11 },
                                    usePointStyle: true,
                                    boxWidth: 8,
                                    padding: 12
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: false },
                                ticks: { maxTicksLimit: 8, font: { size: 10 } }
                            },
                            y: {
                                grid: { color: 'rgba(0,0,0,0.08)' },
                                ticks: { font: { size: 10 } }
                            }
                        }
                    }
                });
            }

            // RSI Ï∞®Ìä∏
            if (rsiData && rsiData.length > 0) {
                const rsiCtx = document.getElementById(`rsiChart_${ticker}`).getContext('2d');
                const rsiLabels = rsiData.map(d => d.date.slice(5));
                const rsiValues = rsiData.map(d => d.value);

                tickerCharts[`${ticker}_rsi`] = new Chart(rsiCtx, {
                    type: 'line',
                    data: {
                        labels: rsiLabels,
                        datasets: [{
                            label: 'RSI',
                            data: rsiValues,
                            borderColor: rsiColor,
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            fill: true,
                            tension: 0.3,
                            pointRadius: 2,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { grid: { display: false }, ticks: { maxTicksLimit: 6, font: { size: 10 } } },
                            y: { grid: { color: 'rgba(0,0,0,0.05)' }, ticks: { font: { size: 10 } }, min: 20, max: 80 }
                        }
                    }
                });
            }

            // Í∞ÄÍ≤© Ï∞®Ìä∏
            if (priceData && priceData.length > 0) {
                const priceCtx = document.getElementById(`priceChart_${ticker}`).getContext('2d');
                const priceLabels = priceData.map(d => d.date.slice(5));
                const priceValues = priceData.map(d => d.value);

                tickerCharts[`${ticker}_price`] = new Chart(priceCtx, {
                    type: 'line',
                    data: {
                        labels: priceLabels,
                        datasets: [{
                            label: 'Í∞ÄÍ≤©',
                            data: priceValues,
                            borderColor: priceColor,
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            fill: true,
                            tension: 0.3,
                            pointRadius: 2,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { grid: { display: false }, ticks: { maxTicksLimit: 6, font: { size: 10 } } },
                            y: { grid: { color: 'rgba(0,0,0,0.05)' }, ticks: { font: { size: 10 } } }
                        }
                    }
                });
            }

            tickerCharts[ticker] = true;  // Î†åÎçîÎßÅ ÏôÑÎ£å ÌëúÏãú
        }

        // Ïù¥ÎèôÌèâÍ∑† Í≥ÑÏÇ∞ Ìï®Ïàò
        function calculateMA(data, period) {
            const result = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) {
                    result.push(null);
                } else {
                    let sum = 0;
                    for (let j = 0; j < period; j++) {
                        sum += data[i - j];
                    }
                    result.push(sum / period);
                }
            }
            return result;
        }

        function renderVixChart(vixHistory, vixCurrent) {
            if (!vixHistory || vixHistory.length === 0) {
                document.getElementById('vixCurrentDisplay').textContent = 'Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå';
                return;
            }

            const labels = vixHistory.map(d => d.date.slice(5));  // MM-DD ÌòïÏãù
            const values = vixHistory.map(d => d.value);

            // ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏùÄ Î†àÎ≤® Ï†ïÎ≥¥ ÏÇ¨Ïö©
            const { value: currentValue, level: vixLevel, emoji: vixEmoji, css_class: vixClass } = vixCurrent;

            // Ìó§ÎçîÏóê ÌëúÏãú
            const vixBadge = document.getElementById('vixBadge');
            vixBadge.textContent = vixLevel;
            vixBadge.className = `ticker-accordion-badge ${vixClass}`;

            document.getElementById('vixEmoji').textContent = vixEmoji;

            const vixDisplay = document.getElementById('vixCurrentDisplay');
            vixDisplay.textContent = `VIX ${currentValue}`;
            vixDisplay.className = `ticker-value-highlight ${vixClass}`;

            // VIX ÌôïÏû• ÏÉÅÌÉú Î≥µÏõê
            const vixExpanded = localStorage.getItem('vixExpanded') === 'true';
            if (vixExpanded) {
                document.getElementById('vixAccordionHeader').classList.add('active');
                document.getElementById('vixAccordionContent').classList.add('active');
            }

            const ctx = document.getElementById('vixChart').getContext('2d');

            if (vixChart) vixChart.destroy();

            vixChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'VIX',
                        data: values,
                        borderColor: 'rgb(220, 53, 69)',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 2,
                        pointHoverRadius: 5,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    resizeDelay: 0,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { maxTicksLimit: 6, font: { size: 10 } }
                        },
                        y: {
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            ticks: { font: { size: 10 } }
                        }
                    }
                }
            });
        }

        // Ïù∏Ï¶ù ÌõÑ Ï∞®Ìä∏ Î°úÎìú
        function showMainContainer() {
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('mainContainer').classList.remove('hidden');
            loadMarketHistory();  // Ï∞®Ìä∏ Î°úÎìú
        }

        // ===== ÌñÑÎ≤ÑÍ±∞ Î©îÎâ¥ ÌÜ†Í∏Ä =====
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const sideMenu = document.getElementById('sideMenu');
        const menuOverlay = document.getElementById('menuOverlay');
        const closeMenuBtn = document.getElementById('closeMenuBtn');

        // Î©îÎâ¥ Ïó¥Í∏∞
        function openMenu() {
            hamburgerBtn.classList.add('active');
            sideMenu.classList.add('active');
            menuOverlay.classList.add('active');
            document.body.style.overflow = 'hidden'; // Ïä§ÌÅ¨Î°§ Î∞©ÏßÄ
        }

        // Î©îÎâ¥ Îã´Í∏∞
        function closeMenu() {
            hamburgerBtn.classList.remove('active');
            sideMenu.classList.remove('active');
            menuOverlay.classList.remove('active');
            document.body.style.overflow = ''; // Ïä§ÌÅ¨Î°§ Î≥µÏõê
        }

        // ÌñÑÎ≤ÑÍ±∞ Î≤ÑÌäº ÌÅ¥Î¶≠
        hamburgerBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (sideMenu.classList.contains('active')) {
                closeMenu();
            } else {
                openMenu();
            }
        });

        // Îã´Í∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠
        closeMenuBtn.addEventListener('click', closeMenu);

        // Ïò§Î≤ÑÎ†àÏù¥ ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        menuOverlay.addEventListener('click', closeMenu);

        // ESC ÌÇ§Î°ú Îã´Í∏∞
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && sideMenu.classList.contains('active')) {
                closeMenu();
            }
        });


        // ===== ÎÖÑÎèÑÎ≥Ñ ÏïÑÏΩîÎîîÏñ∏ ÌÜ†Í∏Ä =====
        function toggleYearAccordion(year) {
            const card = document.getElementById('year-card-' + year);
            if (card) {
                card.classList.toggle('active');

                // ÌôïÏû• ÏÉÅÌÉú Ï†ÄÏû•
                const isExpanded = card.classList.contains('active');
                localStorage.setItem('yearExpanded_' + year, isExpanded);
            }
        }

        // ===== Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏïÑÏΩîÎîîÏñ∏ ÌÜ†Í∏Ä =====
        function togglePortfolioAccordion(tradeName) {
            const header = document.querySelector(`[data-portfolio-header="${tradeName}"]`);
            const content = document.querySelector(`[data-portfolio-content="${tradeName}"]`);

            if (header && content) {
                header.classList.toggle('active');
                content.classList.toggle('active');

                // ÌôïÏû• ÏÉÅÌÉú Ï†ÄÏû•
                const isExpanded = content.classList.contains('active');
                let expandedPortfolios = JSON.parse(localStorage.getItem('expandedPortfolios') || '{}');
                expandedPortfolios[tradeName] = isExpanded;
                localStorage.setItem('expandedPortfolios', JSON.stringify(expandedPortfolios));
            }
        }

        // ===== Ïò§ÎäòÏùò Í±∞Îûò ÏïÑÏΩîÎîîÏñ∏ ÌÜ†Í∏Ä =====
        function toggleTodayTradeAccordion(index) {
            const header = document.querySelector(`[data-today-trade-header="${index}"]`);
            const content = document.querySelector(`[data-today-trade-content="${index}"]`);

            if (header && content) {
                header.classList.toggle('active');
                content.classList.toggle('active');
            }
        }

        // ===== ÎÇ†ÏßúÎ≥Ñ Í±∞Îûò ÎÇ¥Ïó≠ Î°úÎî© =====
        let tradesAccordionIndex = 0;
        let currentPreset = 'today';

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatDisplayDate(dateStr) {
            const date = new Date(dateStr);
            return `${date.getMonth() + 1}/${date.getDate()}`;
        }

        function initDatePickers() {
            const today = new Date();
            const todayStr = formatDate(today);

            document.getElementById('startDate').value = todayStr;
            document.getElementById('endDate').value = todayStr;

            // ÌîÑÎ¶¨ÏÖã Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù
            document.querySelectorAll('.date-preset-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const preset = btn.dataset.preset;
                    setDatePreset(preset);

                    // ÌôúÏÑ±Ìôî ÏÉÅÌÉú Î≥ÄÍ≤Ω
                    document.querySelectorAll('.date-preset-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
            document.getElementById('datePickerModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDateModal();
                }
            });

            // Ï¥àÍ∏∞ Î°úÎî©
            loadTradesByDate();
        }

        function openDateModal() {
            document.getElementById('datePickerModal').classList.add('active');
        }

        function closeDateModal() {
            document.getElementById('datePickerModal').classList.remove('active');
        }

        function setDatePreset(preset) {
            currentPreset = preset;
            const today = new Date();
            let startDate = new Date();
            let endDate = today;

            switch (preset) {
                case 'today':
                    startDate = today;
                    break;
                case 'week':
                    startDate.setDate(today.getDate() - 7);
                    break;
                case 'month':
                    startDate.setMonth(today.getMonth() - 1);
                    break;
                case 'all':
                    startDate = new Date('2020-01-01');
                    break;
            }

            document.getElementById('startDate').value = formatDate(startDate);
            document.getElementById('endDate').value = formatDate(endDate);
        }

        function applyDateSelection() {
            loadTradesByDate();
            updateSelectedDateDisplay();
            closeDateModal();
        }

        function updateSelectedDateDisplay() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const display = document.getElementById('selectedDateDisplay');

            const presetLabels = {
                'today': 'Ïò§Îäò',
                'week': '1Ï£ºÏùº',
                'month': '1Í∞úÏõî',
                'all': 'Ï†ÑÏ≤¥'
            };

            // ÌîÑÎ¶¨ÏÖãÍ≥º ÏùºÏπòÌïòÎäîÏßÄ ÌôïÏù∏
            const today = new Date();
            const todayStr = formatDate(today);

            if (startDate === todayStr && endDate === todayStr) {
                display.textContent = 'Ïò§Îäò';
            } else if (startDate === endDate) {
                display.textContent = formatDisplayDate(startDate);
            } else {
                display.textContent = `${formatDisplayDate(startDate)} ~ ${formatDisplayDate(endDate)}`;
            }
        }

        async function loadTradesByDate() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            if (!startDate || !endDate) return;

            const container = document.getElementById('tradesContainer');
            const noTradesMsg = document.getElementById('noTradesMessage');
            const countDisplay = document.getElementById('tradesCountDisplay');

            container.innerHTML = '<div class="trades-loading">Î°úÎî© Ï§ë...</div>';
            noTradesMsg.style.display = 'none';

            try {
                const response = await fetch(`/api/trades?start_date=${startDate}&end_date=${endDate}`);
                const data = await response.json();

                if (data.error) {
                    container.innerHTML = `<div class="trades-loading">Ïò§Î•ò: ${data.error}</div>`;
                    return;
                }

                // Í∏àÏùº ÏàòÏùµÏù¥ ÏûàÏúºÎ©¥ ÏàòÏùµ ÌëúÏãú, ÏóÜÏúºÎ©¥ Îß§Ïàò/Îß§ÎèÑ Í∞úÏàò ÌëúÏãú
                if (data.today_profit_usd > 0) {
                    const profitKRW = Math.round(data.today_profit_krw).toLocaleString('ko-KR');
                    const profitUSD = data.today_profit_usd.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                    countDisplay.innerHTML = `<span style="margin-left: 12px;">Í∏àÏùº ÏàòÏùµ:<span style="background: #fff8e1; color: #f57f17; font-weight: 600; padding: 3px 8px; border-radius: 5px;">‚Ç©${profitKRW} ($${profitUSD})</span></span>`;
                } else {
                    countDisplay.textContent = `${data.buy_count}Îß§Ïàò / ${data.sell_count}Îß§ÎèÑ`;
                }

                if (!data.has_trades) {
                    container.innerHTML = '';
                    noTradesMsg.style.display = 'block';
                    return;
                }

                // Í±∞Îûò ÎÇ¥Ïó≠ Î†åÎçîÎßÅ
                tradesAccordionIndex = 0;
                container.innerHTML = data.trades.map(trade => renderTradeAccordion(trade)).join('');

            } catch (error) {
                console.error('Í±∞Îûò ÎÇ¥Ïó≠ Î°úÎî© Ïò§Î•ò:', error);
                container.innerHTML = '<div class="trades-loading">Î°úÎî© Ïã§Ìå®</div>';
            }
        }

        function renderTradeAccordion(trade) {
            tradesAccordionIndex++;
            const idx = tradesAccordionIndex;
            const dateDisplay = trade.date_str ? `${trade.date_str} ` : '';

            if (trade.type === 'buy') {
                return `
                    <div class="today-trade-header" data-today-trade-header="${idx}" onclick="toggleTodayTradeAccordion('${idx}')">
                        <div class="today-trade-left">
                            <span class="today-trade-toggle">‚ñ∂</span>
                            <span class="today-trade-badge buy">Îß§Ïàò</span>
                            <span class="today-trade-name">${trade.name}</span>
                            <span class="today-trade-symbol">${trade.symbol}</span>
                        </div>
                        <div class="today-trade-right">
                            <span class="today-trade-amount">${trade.amount}Ï£º</span>
                            <span class="today-trade-time">${dateDisplay}${trade.time}</span>
                        </div>
                    </div>
                    <div class="today-trade-content" data-today-trade-content="${idx}">
                        <div class="today-trade-grid">
                            <div class="today-trade-item">
                                <div class="today-trade-label">Îß§ÏàòÍ∞Ä</div>
                                <div class="today-trade-value">$${trade.purchase_price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                            </div>
                            <div class="today-trade-item">
                                <div class="today-trade-label">ÏàòÎüâ</div>
                                <div class="today-trade-value">${trade.amount}Ï£º</div>
                            </div>
                            <div class="today-trade-item full-width">
                                <div class="today-trade-label">Ï¥ùÏï°</div>
                                <div class="today-trade-value" style="color: #667eea;">$${trade.total_price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                const profitClass = trade.profit >= 0 ? 'profit-positive' : 'profit-negative';
                const profitSign = trade.profit >= 0 ? '+' : '';
                return `
                    <div class="today-trade-header" data-today-trade-header="${idx}" onclick="toggleTodayTradeAccordion('${idx}')">
                        <div class="today-trade-left">
                            <span class="today-trade-toggle">‚ñ∂</span>
                            <span class="today-trade-badge sell">Îß§ÎèÑ</span>
                            <span class="today-trade-name">${trade.name}</span>
                            <span class="today-trade-symbol">${trade.symbol}</span>
                        </div>
                        <div class="today-trade-right">
                            <span class="today-trade-amount">${trade.amount}Ï£º</span>
                            <span class="today-trade-time">${dateDisplay}${trade.time}</span>
                        </div>
                    </div>
                    <div class="today-trade-content" data-today-trade-content="${idx}">
                        <div class="today-trade-grid">
                            <div class="today-trade-item">
                                <div class="today-trade-label">Îß§ÏàòÍ∞Ä</div>
                                <div class="today-trade-value">$${trade.buy_price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                            </div>
                            <div class="today-trade-item">
                                <div class="today-trade-label">Îß§ÎèÑÍ∞Ä</div>
                                <div class="today-trade-value" style="color: #2e7d32;">$${trade.sell_price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                            </div>
                            <div class="today-trade-item">
                                <div class="today-trade-label">ÏàòÎüâ</div>
                                <div class="today-trade-value">${trade.amount}Ï£º</div>
                            </div>
                            <div class="today-trade-item">
                                <div class="today-trade-label">ÏàòÏùµÍ∏à</div>
                                <div class="today-trade-value ${profitClass}">${profitSign}$${trade.profit.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                            </div>
                            <div class="today-trade-item full-width">
                                <div class="today-trade-label">ÏàòÏùµÎ•†</div>
                                <div class="today-trade-value ${profitClass}">${profitSign}${trade.profit_rate.toFixed(2)}%</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Ìè≠Ï£Ω Ìö®Í≥º
        let fireworkInterval = null;

        function createFirework() {
            const startX = Math.random() * window.innerWidth;
            const startY = Math.random() * window.innerHeight;

            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ff6600', '#ff0066', '#ffffff', '#ffd700', '#ff1493', '#00ff7f'];

            // ÌååÌã∞ÌÅ¥ ÏÉùÏÑ±
            for (let i = 0; i < 25; i++) {
                setTimeout(() => {
                    const color = colors[Math.floor(Math.random() * colors.length)];

                    const particle = document.createElement('div');
                    particle.style.position = 'fixed';
                    particle.style.left = startX + 'px';
                    particle.style.top = startY + 'px';
                    particle.style.width = '6px';
                    particle.style.height = '6px';
                    particle.style.borderRadius = '50%';
                    particle.style.backgroundColor = color;
                    particle.style.boxShadow = `0 0 10px ${color}`;
                    particle.style.pointerEvents = 'none';
                    particle.style.zIndex = '10001';

                    document.body.appendChild(particle);

                    const angle = (Math.PI * 2 * i) / 25;
                    const velocity = 3 + Math.random() * 4;
                    let vx = Math.cos(angle) * velocity;
                    let vy = Math.sin(angle) * velocity;
                    let posX = startX;
                    let posY = startY;
                    let opacity = 1;

                    const animate = setInterval(() => {
                        vy += 0.15;
                        posX += vx;
                        posY += vy;
                        opacity -= 0.02;

                        particle.style.left = posX + 'px';
                        particle.style.top = posY + 'px';
                        particle.style.opacity = opacity;

                        if (opacity <= 0 || posY > window.innerHeight) {
                            clearInterval(animate);
                            particle.remove();
                        }
                    }, 30);
                }, i * 2);
            }
        }

        function startFireworks() {
            if (!fireworkInterval) {
                fireworkInterval = setInterval(createFirework, 800);
            }
        }

        function stopFireworks() {
            if (fireworkInterval) {
                clearInterval(fireworkInterval);
                fireworkInterval = null;
            }
        }

        function closeProfitModal() {
            document.getElementById('profitModal').classList.add('hidden');
            stopFireworks();

            // Ïò§Îäò ÎÇ†ÏßúÎ°ú Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû• (Ïò§ÎäòÏùÄ Îã§Ïãú Ïïà Î≥¥ÏûÑ)
            const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
            localStorage.setItem('profitModalShown', today);
        }

        // ÌÉ≠Ïù¥ Î∞±Í∑∏ÎùºÏö¥ÎìúÎ°ú Í∞ÄÎ©¥ Ìè≠Ï£Ω Î©àÏ∂îÍ∏∞ (Î∞ÄÎ¶º ÌòÑÏÉÅ Î∞©ÏßÄ)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // ÌÉ≠Ïù¥ Î∞±Í∑∏ÎùºÏö¥ÎìúÎ°ú Í∞ÄÎ©¥ Ìè≠Ï£Ω Î©àÏ∂§
                if (fireworkInterval) {
                    stopFireworks();
                    // Î™®Îã¨Ïù¥ Ïó¥Î†§ÏûàÏúºÎ©¥ Îã§Ïãú ÏãúÏûëÌï† ÌîåÎûòÍ∑∏ Ï†ÄÏû•
                    if (!document.getElementById('profitModal').classList.contains('hidden')) {
                        window._fireworkPaused = true;
                    }
                }
            } else {
                // ÌÉ≠Ïù¥ Îã§Ïãú Ìè¨Í∑∏ÎùºÏö¥ÎìúÎ°ú Ïò§Î©¥ Ìè≠Ï£Ω Ïû¨ÏãúÏûë
                if (window._fireworkPaused && !document.getElementById('profitModal').classList.contains('hidden')) {
                    startFireworks();
                    window._fireworkPaused = false;
                }
            }
        });

        function checkTodayProfit() {
            // Ïò§Îäò Ïù¥ÎØ∏ Î™®Îã¨ÏùÑ Î≥∏ Í≤ΩÏö∞ Ïä§ÌÇµ
            const today = new Date().toISOString().split('T')[0];
            const lastShown = localStorage.getItem('profitModalShown');

            if (lastShown === today) {
                console.log('Today profit modal already shown');
                return;
            }

            fetch('/api/check_today_profit')
                .then(response => response.json())
                .then(data => {
                    if (data.has_profit) {
                        const totalProfit = data.total_profit_usd;

                        // ÏàòÏùµ/ÏÜêÏã§Ïóê Îî∞Îùº Ïù¥Î™®Ìã∞ÏΩò Î≥ÄÍ≤Ω
                        const emojiElement = document.getElementById('profitEmoji');
                        const titleElement = document.getElementById('profitTitle');

                        if (totalProfit > 0) {
                            // ÏàòÏùµ: Ï∂ïÌïò Ïù¥Î™®Ìã∞ÏΩò
                            emojiElement.textContent = 'üéâ';
                            titleElement.textContent = 'üéâ Ï∂ïÌïòÌï©ÎãàÎã§! üéâ';
                        } else {
                            // ÏÜêÏã§: ÎπÑ Ïò§Îäî Ïù¥Î™®Ìã∞ÏΩò
                            emojiElement.textContent = 'üåßÔ∏è';
                            titleElement.textContent = 'ÏÜêÏã§Ïù¥ Î∞úÏÉùÌñàÏäµÎãàÎã§';
                        }

                        // ÏõêÌôî ÏàòÏùµ ÌëúÏãú (Î©îÏù∏)
                        document.getElementById('profitAmountKRW').textContent =
                            '‚Ç©' + Math.round(data.total_profit_krw).toLocaleString('ko-KR');

                        // Îã¨Îü¨ ÏàòÏùµ ÌëúÏãú (ÏÑúÎ∏å)
                        document.getElementById('profitAmountUSD').textContent =
                            '$' + data.total_profit_usd.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});

                        // Î™®Îã¨ ÌëúÏãú
                        document.getElementById('profitModal').classList.remove('hidden');

                        // ÏàòÏùµÏùº ÎïåÎßå Ìè≠Ï£Ω ÏãúÏûë
                        if (totalProfit > 0) {
                            startFireworks();
                        }
                    }
                })
                .catch(error => console.error('Error checking profit:', error));
        }

        // Ïù∏Ï¶ù ÌõÑ ÎÇ†Ïßú ÌîºÏª§ Ï¥àÍ∏∞Ìôî Î∞è ÏàòÏùµ Ï≤¥ÌÅ¨
        const originalShowMainContainer = showMainContainer;
        showMainContainer = function() {
            originalShowMainContainer();
            initDatePickers();

            // Î°úÍ∑∏Ïù∏ ÌõÑ Ïò§Îäò ÏàòÏùµ Ï≤¥ÌÅ¨
            checkTodayProfit();
        };
    </script>
</body>
</html>
