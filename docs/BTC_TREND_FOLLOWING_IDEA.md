# 비트코인 추세추종 롱/숏 전략

## 개요

기존 티어 기반 분할 매매 전략을 **양방향 추세추종**에 맞게 변형한다.

**구조:**
- 이평선 → 추세 방향 판단 (롱/숏 결정)
- 평단가 + 동적지점 → 진입/청산 지점 계산 (기존 EggMoney 방식)

---

## 1. 추세 판단 - 이평선 배열

```
정배열 (상승 추세):
  단기 > 중기 > 장기
  예: 5일선 > 20일선 > 60일선
  → 롱 포지션만 진입 허용

역배열 (하락 추세):
  단기 < 중기 < 장기
  예: 5일선 < 20일선 < 60일선
  → 숏 포지션만 진입 허용

혼조:
  배열이 불규칙
  → 신규 진입 금지 (관망)
```

---

## 2. 티어(T) - 포지션 진입률

```
T = 현재 투자금 / 1회 투자금

예시 (1회 $1,000, 최대 10회):
  T=1  → 10% 진입
  T=5  → 50% 진입
  T=10 → 100% 진입 (풀 포지션)
```

---

## 3. 동적지점 - T에 따라 변하는 매매 기준

**공식 (P1_2 기준):**

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   동적지점% = 최대폭 × (1 - 2 × T / MaxT)               │
│                                                         │
│   동적지점가 = 평단가 × (1 + 동적지점%)                  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**예시 (최대폭 20%, MaxT=10):**

| T | 동적지점% | 의미 |
|---|----------|------|
| 0 | +20% | 평단가 +20% 지점 |
| 2 | +12% | 평단가 +12% 지점 |
| 5 | 0% | 평단가 지점 |
| 8 | -12% | 평단가 -12% 지점 |
| 10 | -20% | 평단가 -20% 지점 |

**시각화:**

```
동적지점%
 +20% ┤■
      │ ■
 +10% ┤  ■
      │   ■
   0% ┼────■─────────
      │     ■
 -10% ┤      ■
      │       ■
 -20% ┤        ■
      └──────────────→ T
      0  2  4  6  8  10
```

---

## 4. 매수/매도 조건

### 롱 포지션

```
진입 허용: 이평선 정배열일 때만

매수 조건: 현재가 < 동적지점가
  → 물타기 (포지션 추가)

매도 조건: 현재가 > 동적지점가
  → 1/4 청산
```

### 숏 포지션

```
진입 허용: 이평선 역배열일 때만

매도(숏 진입) 조건: 현재가 > 동적지점가
  → 물타기 (포지션 추가)

매수(숏 청산) 조건: 현재가 < 동적지점가
  → 1/4 청산
```

---

## 5. 물타기 ↔ 손절 사이클

```
┌─────────────────────────────────────────┐
│                                         │
│   현재가 < 동적지점가                    │
│        ↓                                │
│   물타기 (T 증가)                        │
│        ↓                                │
│   T = Max 도달                          │
│        ↓                                │
│   1/4 손절 (T 감소)                      │
│        ↓                                │
│   다시 물타기 여력 생김                  │
│        ↓                                │
│   반복...                               │
│                                         │
└─────────────────────────────────────────┘
```

**결과:**
- 급락 시 무한 손절 X
- 물타기로 평단가 계속 낮춤
- 반등 시 동적지점가 돌파하면 익절
- 포지션 크기 자동 조절

---

## 6. 추세 전환 시 추가 로직 (아이디어)

**문제:**
```
롱 보유 중 → 이평선 역배열로 전환

기본 로직만으로는:
  - 동적지점가 돌파 시에만 청산
  - 추세 전환과 무관하게 동작
  - 추세가 완전히 꺾여도 동적지점가까지 안 오면 계속 홀딩
```

### 아이디어 1: 추세 전환 시 동적지점 시프트

```
추세 전환 감지 시 → 동적지점%를 강제로 낮춤

정상 상태:
  동적지점% = 최대폭 × (1 - 2 × T / MaxT)

추세 전환 시:
  동적지점% = 동적지점% - 시프트값
  시프트값 = 최대폭 × (1 - T / MaxT)  ← T 낮으면 많이 시프트

예시 (T=2, 최대폭 20%):
  정상: +12%
  시프트값: 20% × 0.8 = 16%
  전환 후: +12% - 16% = -4%

  → 청산 기준이 확 내려감 → 빠른 청산 유도
```

### 아이디어 2: 추세 전환 시 별도 타이머

```
추세 전환 감지 → N캔들 타이머 시작

타이머 동안:
  - 추세 복귀하면 → 타이머 취소
  - 추세 유지되면 → 타이머 종료 시 1/4 강제 청산

N = T 기반으로 조절
  T 낮음 → N 큼 (오래 기다림)
  T 높음 → N 작음 (빨리 청산)
```

### 아이디어 3: 추세 전환 시 동적지점 계산 기준 변경

```
정상 상태: 평단가 기준
추세 전환 시: 이평선 기준으로 전환

동적지점가 = 이평선 × (1 + 동적지점%)

→ 평단가보다 이평선이 높으면 청산 기준도 높아짐
→ 더 빨리 청산됨
```

### 아이디어 4: 추세 전환 시 MaxT 축소

```
추세 전환 감지 → MaxT를 임시로 줄임

정상: MaxT = 10
전환 시: MaxT' = MaxT × (1 - 전환강도)

전환강도 = 이평선 기울기 or 크로스 횟수 기반

효과:
  MaxT가 줄면 → 현재 T가 상대적으로 높아짐
  → 동적지점%가 낮아짐 → 청산 기준 낮아짐
```

### 아이디어 5: 추세 전환 시 분할 청산 가속

```
정상: 동적지점 돌파 시 1/4 청산
전환 시: 동적지점 돌파 시 2/4 또는 3/4 청산

청산 비율 = 기본비율 + 추가비율 × (T / MaxT)
  T 높을수록 더 많이 청산
```

### 아이디어 6: 추세 전환 + ATR 기반 트레일링 스탑

```
추세 전환 감지 → 트레일링 스탑 활성화

스탑가 = 최고가 - ATR × 배수
배수 = T 기반 (T 낮으면 넓게, T 높으면 좁게)

현재가 < 스탑가 → 청산
```

---

## 7. 아이디어 비교

| 아이디어 | 복잡도 | 장점 | 단점 |
|----------|--------|------|------|
| 1. 동적지점 시프트 | 낮음 | 기존 로직에 자연스럽게 통합 | 시프트값 튜닝 필요 |
| 2. 타이머 | 중간 | 휩소 필터링 가능 | 상태 관리 필요 |
| 3. 기준 변경 | 낮음 | 시장 상황 반영 | 평단가-이평선 괴리 클 때 급격한 변화 |
| 4. MaxT 축소 | 중간 | 전체 시스템에 영향 | 계산 복잡 |
| 5. 청산 가속 | 낮음 | 구현 간단 | 과도한 청산 위험 |
| 6. 트레일링 스탑 | 높음 | 수익 보호에 효과적 | 별도 로직 필요 |

---

## 8. 추천 조합

**기본 + 아이디어 1 조합:**

```
1. 기본 로직
   - 이평선으로 방향 판단
   - 평단가 + 동적지점으로 매수/매도
   - T=Max 시 1/4 손절

2. 추세 전환 시
   - 동적지점% 시프트 적용
   - 시프트값 = 최대폭 × (1 - T / MaxT)
   - 청산 기준이 내려가서 빠른 청산 유도

3. T 기반 차등
   - T 낮음 → 시프트 큼 → 많이 버팀 (휩소 대응)
   - T 높음 → 시프트 작음 → 빨리 청산 (리스크 관리)
```

---

## 다음 단계

- [ ] 아이디어 선택 및 확정
- [ ] 백테스트 설계
- [ ] 파라미터 튜닝 (최대폭, MaxT, 시프트값 등)
- [ ] 구현
